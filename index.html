<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Accounting Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@tensorflow/tfjs"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-globe text-white text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Global Accounting</h1>
                <p class="text-gray-600">AI-Powered Professional Dashboard</p>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Your Country</label>
                <select id="countrySelector" class="w-full border-2 border-gray-300 rounded-lg py-3 px-4 focus:border-blue-500 focus:outline-none">
                    <option value="US">ðŸ‡ºðŸ‡¸ United States (USD)</option>
                    <option value="GB">ðŸ‡¬ðŸ‡§ United Kingdom (GBP)</option>
                    <option value="EU">ðŸ‡ªðŸ‡º European Union (EUR)</option>
                    <option value="ZA">ðŸ‡¿ðŸ‡¦ South Africa (ZAR)</option>
                    <option value="AU">ðŸ‡¦ðŸ‡º Australia (AUD)</option>
                    <option value="CA">ðŸ‡¨ðŸ‡¦ Canada (CAD)</option>
                    <option value="IN">ðŸ‡®ðŸ‡³ India (INR)</option>
                    <option value="SG">ðŸ‡¸ðŸ‡¬ Singapore (SGD)</option>
                </select>
            </div>
            
            <button id="googleSignIn" class="w-full bg-white border-2 border-gray-300 rounded-lg py-3 px-4 flex items-center justify-center space-x-3 hover:bg-gray-50 transition-colors duration-200 mb-4">
                <svg class="w-5 h-5" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <span class="text-gray-700 font-medium">Continue with Google</span>
            </button>
            
            <div class="text-center text-sm text-gray-500">
                Secure authentication powered by Google
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 w-10 h-10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-globe text-white"></i>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-900">Global Accounting</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="userInfo" class="flex items-center space-x-3">
                            <img id="userAvatar" class="w-8 h-8 rounded-full" src="" alt="User">
                            <span id="userName" class="text-gray-700 font-medium"></span>
                        </div>
                        <button id="signOut" class="text-gray-500 hover:text-gray-700 transition-colors">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button class="nav-tab active border-b-2 border-blue-500 py-4 px-1 text-blue-600 font-medium" data-tab="overview">
                        <i class="fas fa-chart-line mr-2"></i>Overview
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium" data-tab="transactions">
                        <i class="fas fa-exchange-alt mr-2"></i>Transactions
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium" data-tab="clients">
                        <i class="fas fa-users mr-2"></i>Clients
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium" data-tab="ai-upload">
                        <i class="fas fa-robot mr-2"></i>AI Upload
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium" data-tab="tax-calendar">
                        <i class="fas fa-calendar-alt mr-2"></i>Tax Calendar
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium" data-tab="reports">
                        <i class="fas fa-file-alt mr-2"></i>Reports
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Total Revenue</p>
                                <p class="text-3xl font-bold text-gray-900" id="totalRevenue">$245,680</p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>12.5% from last month
                                </p>
                            </div>
                            <div class="bg-green-100 p-3 rounded-full">
                                <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Active Clients</p>
                                <p class="text-3xl font-bold text-gray-900">47</p>
                                <p class="text-sm text-blue-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>3 new this month
                                </p>
                            </div>
                            <div class="bg-blue-100 p-3 rounded-full">
                                <i class="fas fa-users text-blue-600 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Pending Invoices</p>
                                <p class="text-3xl font-bold text-gray-900">12</p>
                                <p class="text-sm text-orange-600 mt-1">
                                    <i class="fas fa-clock mr-1"></i>R 45,230 outstanding
                                </p>
                            </div>
                            <div class="bg-orange-100 p-3 rounded-full">
                                <i class="fas fa-file-invoice text-orange-600 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Monthly Expenses</p>
                                <p class="text-3xl font-bold text-gray-900">R 89,450</p>
                                <p class="text-sm text-red-600 mt-1">
                                    <i class="fas fa-arrow-down mr-1"></i>5.2% from last month
                                </p>
                            </div>
                            <div class="bg-red-100 p-3 rounded-full">
                                <i class="fas fa-credit-card text-red-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Revenue Trend</h3>
                        <canvas id="revenueChart" width="400" height="200"></canvas>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Expense Categories</h3>
                        <canvas id="expenseChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">Recent Activity</h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <div class="bg-green-100 p-2 rounded-full">
                                    <i class="fas fa-plus text-green-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900">Payment received from ABC Corp</p>
                                    <p class="text-sm text-gray-500">Invoice #INV-2024-001 â€¢ R 15,500</p>
                                </div>
                                <span class="text-sm text-gray-500">2 hours ago</span>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="bg-blue-100 p-2 rounded-full">
                                    <i class="fas fa-file-alt text-blue-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900">New invoice created</p>
                                    <p class="text-sm text-gray-500">XYZ Ltd â€¢ Invoice #INV-2024-002 â€¢ R 8,750</p>
                                </div>
                                <span class="text-sm text-gray-500">5 hours ago</span>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="bg-orange-100 p-2 rounded-full">
                                    <i class="fas fa-exclamation-triangle text-orange-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900">Invoice overdue</p>
                                    <p class="text-sm text-gray-500">DEF Company â€¢ Invoice #INV-2024-003 â€¢ R 12,300</p>
                                </div>
                                <span class="text-sm text-gray-500">1 day ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">Recent Transactions</h3>
                        <button id="addTransactionBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Transaction
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">2024-01-15</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Monthly Bookkeeping</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">ABC Corp</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">+R 15,500</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Paid</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">2024-01-14</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Tax Consultation</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">XYZ Ltd</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">+R 8,750</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">2024-01-13</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Office Supplies</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">-</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600">-R 1,250</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">Expense</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Clients Tab -->
            <div id="clients" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">Client Management</h3>
                        <button id="addClientBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Client
                        </button>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="bg-blue-100 w-10 h-10 rounded-full flex items-center justify-center">
                                        <i class="fas fa-building text-blue-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">ABC Corporation</h4>
                                        <p class="text-sm text-gray-500">Manufacturing</p>
                                    </div>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <p class="text-gray-600"><i class="fas fa-envelope mr-2"></i>contact@abc-corp.co.za</p>
                                    <p class="text-gray-600"><i class="fas fa-phone mr-2"></i>+27 11 123 4567</p>
                                    <p class="text-green-600 font-medium"><i class="fas fa-dollar-sign mr-2"></i>R 45,500 YTD</p>
                                </div>
                            </div>
                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="bg-green-100 w-10 h-10 rounded-full flex items-center justify-center">
                                        <i class="fas fa-store text-green-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">XYZ Retail Ltd</h4>
                                        <p class="text-sm text-gray-500">Retail</p>
                                    </div>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <p class="text-gray-600"><i class="fas fa-envelope mr-2"></i>info@xyz-retail.co.za</p>
                                    <p class="text-gray-600"><i class="fas fa-phone mr-2"></i>+27 21 987 6543</p>
                                    <p class="text-green-600 font-medium"><i class="fas fa-dollar-sign mr-2"></i>R 32,750 YTD</p>
                                </div>
                            </div>
                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="bg-purple-100 w-10 h-10 rounded-full flex items-center justify-center">
                                        <i class="fas fa-laptop text-purple-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Tech Solutions</h4>
                                        <p class="text-sm text-gray-500">Technology</p>
                                    </div>
                                </div>
                                <div class="space-y-2 text-sm">
                                    <p class="text-gray-600"><i class="fas fa-envelope mr-2"></i>hello@techsolutions.co.za</p>
                                    <p class="text-gray-600"><i class="fas fa-phone mr-2"></i>+27 31 555 0123</p>
                                    <p class="text-green-600 font-medium"><i class="fas fa-dollar-sign mr-2"></i>R 28,900 YTD</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Upload Tab -->
            <div id="ai-upload" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Upload Section -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-robot text-blue-600 mr-2"></i>AI Bank Statement Processor
                        </h3>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-lg font-medium text-gray-700 mb-2">Upload Your Bank Statement</p>
                            <p class="text-sm text-gray-500 mb-4">Supports CSV, PDF, and Excel files</p>
                            <input type="file" id="bankStatementUpload" accept=".csv,.pdf,.xlsx,.xls" class="hidden">
                            <button onclick="document.getElementById('bankStatementUpload').click()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-upload mr-2"></i>Choose File
                            </button>
                        </div>
                        
                        <!-- Processing Status -->
                        <div id="processingStatus" class="hidden mt-6">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
                                    <div>
                                        <p class="font-medium text-blue-800">AI Processing Your Statement...</p>
                                        <p class="text-sm text-blue-600">Categorizing transactions and identifying clients</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Insights -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-brain text-purple-600 mr-2"></i>AI Insights
                        </h3>
                        <div id="aiInsights" class="space-y-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <p class="text-sm text-gray-600">Upload a bank statement to see AI-powered insights about your transactions, spending patterns, and automatic categorization.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Processed Transactions Preview -->
                <div id="processedTransactions" class="hidden mt-8 bg-white rounded-xl shadow-sm border border-gray-100">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">AI Processed Transactions</h3>
                        <p class="text-sm text-gray-600">Review and approve the AI categorization before importing</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AI Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Confidence</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Action</th>
                                </tr>
                            </thead>
                            <tbody id="processedTransactionsBody" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                    <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                        <button id="rejectAll" class="px-4 py-2 text-gray-600 hover:text-gray-800">Reject All</button>
                        <button id="approveAll" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Approve & Import All</button>
                    </div>
                </div>
            </div>

            <!-- Tax Calendar Tab -->
            <div id="tax-calendar" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Calendar View -->
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <i class="fas fa-calendar-alt text-green-600 mr-2"></i>Tax Compliance Calendar
                            </h3>
                            <div class="flex items-center space-x-2">
                                <button id="prevMonth" class="p-2 hover:bg-gray-100 rounded-lg">
                                    <i class="fas fa-chevron-left text-gray-600"></i>
                                </button>
                                <span id="currentMonth" class="font-medium text-gray-900 px-4">January 2024</span>
                                <button id="nextMonth" class="p-2 hover:bg-gray-100 rounded-lg">
                                    <i class="fas fa-chevron-right text-gray-600"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Calendar Grid -->
                        <div class="grid grid-cols-7 gap-1 mb-4">
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Sun</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Mon</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Tue</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Wed</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Thu</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Fri</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Sat</div>
                        </div>
                        <div id="calendarGrid" class="grid grid-cols-7 gap-1">
                            <!-- Calendar days will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Upcoming Deadlines -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-exclamation-triangle text-orange-600 mr-2"></i>Upcoming Deadlines
                        </h3>
                        <div id="upcomingDeadlines" class="space-y-4">
                            <!-- Deadlines will be populated based on selected country -->
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <button id="addCustomDeadline" class="w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <i class="fas fa-plus text-blue-600 mr-2"></i>
                                <span class="text-gray-700">Add Custom Deadline</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Tax Reminders -->
                <div class="mt-8 bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-bell text-yellow-600 mr-2"></i>Smart Tax Reminders
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-gray-900">Quarterly VAT Return</h4>
                                <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full">Due Soon</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Due: March 31, 2024</p>
                            <button class="text-sm text-blue-600 hover:text-blue-800">Set Reminder</button>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-gray-900">Annual Tax Return</h4>
                                <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Upcoming</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Due: July 31, 2024</p>
                            <button class="text-sm text-blue-600 hover:text-blue-800">Set Reminder</button>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-gray-900">Payroll Tax</h4>
                                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">On Track</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Due: February 15, 2024</p>
                            <button class="text-sm text-blue-600 hover:text-blue-800">Set Reminder</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Generate Reports</h3>
                        <div class="space-y-4">
                            <button id="monthlyReportBtn" class="w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-chart-bar text-blue-600"></i>
                                    <div>
                                        <h4 class="font-medium text-gray-900">Monthly Financial Report</h4>
                                        <p class="text-sm text-gray-500">Comprehensive overview of monthly finances</p>
                                    </div>
                                </div>
                            </button>
                            <button id="taxSummaryBtn" class="w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-file-invoice text-green-600"></i>
                                    <div>
                                        <h4 class="font-medium text-gray-900">Tax Summary</h4>
                                        <p class="text-sm text-gray-500">Annual tax preparation summary</p>
                                    </div>
                                </div>
                            </button>
                            <button id="clientRevenueBtn" class="w-full text-left p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-users text-purple-600"></i>
                                    <div>
                                        <h4 class="font-medium text-gray-900">Client Revenue Report</h4>
                                        <p class="text-sm text-gray-500">Revenue breakdown by client</p>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Stats</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">This Month Revenue</span>
                                <span class="font-semibold text-gray-900">R 67,450</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">Outstanding Invoices</span>
                                <span class="font-semibold text-orange-600">R 45,230</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">Total Expenses</span>
                                <span class="font-semibold text-red-600">R 23,180</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">Net Profit</span>
                                <span class="font-semibold text-green-600">R 44,270</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Demo mode - bypassing Supabase for now
        let isDemoMode = true
        let currentUser = null

        // Country configurations
        const countryConfigs = {
            US: {
                currency: 'USD',
                symbol: '$',
                taxRate: 0.21,
                dateFormat: 'MM/DD/YYYY',
                taxDeadlines: [
                    { name: 'Quarterly Tax Return', date: '2024-03-15', type: 'quarterly' },
                    { name: 'Annual Tax Return', date: '2024-04-15', type: 'annual' },
                    { name: 'Payroll Tax', date: '2024-01-31', type: 'monthly' }
                ]
            },
            GB: {
                currency: 'GBP',
                symbol: 'Â£',
                taxRate: 0.19,
                dateFormat: 'DD/MM/YYYY',
                taxDeadlines: [
                    { name: 'VAT Return', date: '2024-02-07', type: 'quarterly' },
                    { name: 'Corporation Tax', date: '2024-12-31', type: 'annual' },
                    { name: 'PAYE', date: '2024-01-19', type: 'monthly' }
                ]
            },
            EU: {
                currency: 'EUR',
                symbol: 'â‚¬',
                taxRate: 0.25,
                dateFormat: 'DD/MM/YYYY',
                taxDeadlines: [
                    { name: 'VAT Declaration', date: '2024-01-20', type: 'monthly' },
                    { name: 'Corporate Tax', date: '2024-03-31', type: 'annual' },
                    { name: 'Social Security', date: '2024-01-15', type: 'monthly' }
                ]
            },
            ZA: {
                currency: 'ZAR',
                symbol: 'R',
                taxRate: 0.28,
                dateFormat: 'DD/MM/YYYY',
                taxDeadlines: [
                    { name: 'VAT Return', date: '2024-01-25', type: 'monthly' },
                    { name: 'Company Tax', date: '2024-07-31', type: 'annual' },
                    { name: 'PAYE', date: '2024-01-07', type: 'monthly' }
                ]
            },
            AU: {
                currency: 'AUD',
                symbol: 'A$',
                taxRate: 0.30,
                dateFormat: 'DD/MM/YYYY',
                taxDeadlines: [
                    { name: 'BAS Statement', date: '2024-01-28', type: 'quarterly' },
                    { name: 'Company Tax Return', date: '2024-05-15', type: 'annual' },
                    { name: 'Payroll Tax', date: '2024-01-21', type: 'monthly' }
                ]
            },
            CA: {
                currency: 'CAD',
                symbol: 'C$',
                taxRate: 0.26,
                dateFormat: 'DD/MM/YYYY',
                taxDeadlines: [
                    { name: 'GST/HST Return', date: '2024-01-31', type: 'quarterly' },
                    { name: 'Corporate Tax', date: '2024-06-15', type: 'annual' },
                    { name: 'Payroll Deductions', date: '2024-01-15', type: 'monthly' }
                ]
            },
            IN: {
                currency: 'INR',
                symbol: 'â‚¹',
                taxRate: 0.30,
                dateFormat: 'DD/MM/YYYY',
                taxDeadlines: [
                    { name: 'GST Return', date: '2024-01-20', type: 'monthly' },
                    { name: 'Income Tax Return', date: '2024-07-31', type: 'annual' },
                    { name: 'TDS Return', date: '2024-01-31', type: 'quarterly' }
                ]
            },
            SG: {
                currency: 'SGD',
                symbol: 'S$',
                taxRate: 0.17,
                dateFormat: 'DD/MM/YYYY',
                taxDeadlines: [
                    { name: 'GST Return', date: '2024-01-30', type: 'quarterly' },
                    { name: 'Corporate Tax', date: '2024-11-30', type: 'annual' },
                    { name: 'CPF Contributions', date: '2024-01-14', type: 'monthly' }
                ]
            }
        }

        let selectedCountry = 'US'
        let currentConfig = countryConfigs[selectedCountry]

        // DOM elements
        const loginScreen = document.getElementById('loginScreen')
        const dashboard = document.getElementById('dashboard')
        const googleSignInBtn = document.getElementById('googleSignIn')
        const signOutBtn = document.getElementById('signOut')
        const userAvatar = document.getElementById('userAvatar')
        const userName = document.getElementById('userName')

        // AI Transaction Processing
        class AITransactionProcessor {
            constructor() {
                this.categories = [
                    'Office Supplies', 'Marketing', 'Travel', 'Software', 'Consulting',
                    'Utilities', 'Rent', 'Insurance', 'Professional Services', 'Equipment',
                    'Client Payment', 'Refund', 'Bank Fee', 'Interest', 'Other'
                ]
            }

            async processFile(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader()
                    reader.onload = (e) => {
                        const content = e.target.result
                        const transactions = this.parseTransactions(content, file.type)
                        const processedTransactions = transactions.map(t => this.categorizeTransaction(t))
                        resolve(processedTransactions)
                    }
                    reader.readAsText(file)
                })
            }

            parseTransactions(content, fileType) {
                const lines = content.split('\n').filter(line => line.trim())
                const transactions = []
                
                // Skip header row
                for (let i = 1; i < lines.length; i++) {
                    const columns = lines[i].split(',')
                    if (columns.length >= 3) {
                        transactions.push({
                            date: columns[0]?.trim() || new Date().toISOString().split('T')[0],
                            description: columns[1]?.trim() || 'Unknown Transaction',
                            amount: parseFloat(columns[2]?.replace(/[^\d.-]/g, '')) || 0,
                            reference: columns[3]?.trim() || ''
                        })
                    }
                }
                
                return transactions
            }

            categorizeTransaction(transaction) {
                const desc = transaction.description.toLowerCase()
                let category = 'Other'
                let confidence = 0.5
                let client = null

                // AI-like categorization logic
                if (desc.includes('office') || desc.includes('supplies') || desc.includes('stationery')) {
                    category = 'Office Supplies'
                    confidence = 0.9
                } else if (desc.includes('marketing') || desc.includes('advertising') || desc.includes('social media')) {
                    category = 'Marketing'
                    confidence = 0.85
                } else if (desc.includes('travel') || desc.includes('flight') || desc.includes('hotel')) {
                    category = 'Travel'
                    confidence = 0.9
                } else if (desc.includes('software') || desc.includes('subscription') || desc.includes('saas')) {
                    category = 'Software'
                    confidence = 0.85
                } else if (desc.includes('consulting') || desc.includes('professional') || desc.includes('legal')) {
                    category = 'Professional Services'
                    confidence = 0.8
                } else if (desc.includes('rent') || desc.includes('lease')) {
                    category = 'Rent'
                    confidence = 0.95
                } else if (desc.includes('insurance')) {
                    category = 'Insurance'
                    confidence = 0.9
                } else if (desc.includes('payment') || desc.includes('invoice') || transaction.amount > 0) {
                    category = 'Client Payment'
                    confidence = 0.7
                    // Try to extract client name
                    const words = desc.split(' ')
                    client = words.find(word => word.length > 3 && !['payment', 'invoice', 'from', 'received'].includes(word))
                }

                return {
                    ...transaction,
                    category,
                    confidence,
                    client: client || 'General',
                    status: transaction.amount > 0 ? 'Paid' : 'Expense'
                }
            }
        }

        const aiProcessor = new AITransactionProcessor()

        // Authentication functions
        async function signInWithGoogle() {
            try {
                selectedCountry = document.getElementById('countrySelector').value
                currentConfig = countryConfigs[selectedCountry]
                localStorage.setItem('selectedCountry', selectedCountry)
                
                // Demo user for instant access
                currentUser = {
                    id: 'demo-user-123',
                    email: 'demo@globalaccounting.com',
                    user_metadata: {
                        full_name: 'Demo User',
                        avatar_url: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=32&h=32&fit=crop&crop=face&auto=format'
                    }
                }
                
                showDashboard(currentUser)
                loadUserData(currentUser.id)
                
            } catch (error) {
                console.error('Error signing in:', error.message)
                alert('Error signing in: ' + error.message)
            }
        }

        async function signOut() {
            try {
                currentUser = null
                localStorage.removeItem('currentUser')
                showLoginScreen()
            } catch (error) {
                console.error('Error signing out:', error.message)
            }
        }

        function showLoginScreen() {
            loginScreen.classList.remove('hidden')
            dashboard.classList.add('hidden')
        }

        function showDashboard(user) {
            loginScreen.classList.add('hidden')
            dashboard.classList.remove('hidden')
            
            // Save user to localStorage
            localStorage.setItem('currentUser', JSON.stringify(user))
            
            // Update user info
            if (user.user_metadata) {
                userName.textContent = user.user_metadata.full_name || user.email
                userAvatar.src = user.user_metadata.avatar_url || 'https://via.placeholder.com/32'
            }
        }

        // Global functions for AI transaction approval
        window.approveTransaction = function(index) {
            const transaction = window.pendingTransactions[index]
            userData.transactions.unshift(transaction)
            saveUserData(currentUser.id)
            updateAllDisplays()
            
            // Remove from pending
            window.pendingTransactions.splice(index, 1)
            displayProcessedTransactions(window.pendingTransactions)
        }

        window.rejectTransaction = function(index) {
            window.pendingTransactions.splice(index, 1)
            displayProcessedTransactions(window.pendingTransactions)
        }

        // Approve all transactions
        document.getElementById('approveAll').addEventListener('click', function() {
            if (window.pendingTransactions && window.pendingTransactions.length > 0) {
                window.pendingTransactions.forEach(transaction => {
                    userData.transactions.unshift(transaction)
                })
                saveUserData(currentUser.id)
                updateAllDisplays()
                
                // Clear pending transactions
                window.pendingTransactions = []
                document.getElementById('processedTransactions').classList.add('hidden')
                
                alert('All transactions have been imported successfully!')
            }
        })

        // Reject all transactions
        document.getElementById('rejectAll').addEventListener('click', function() {
            window.pendingTransactions = []
            document.getElementById('processedTransactions').classList.add('hidden')
        })

        // Initialize app
        function initializeApp() {
            // Load saved country preference
            const savedCountry = localStorage.getItem('selectedCountry')
            if (savedCountry && countryConfigs[savedCountry]) {
                selectedCountry = savedCountry
                currentConfig = countryConfigs[savedCountry]
                document.getElementById('countrySelector').value = savedCountry
            }
            
            // Check if user was previously signed in
            const savedUser = localStorage.getItem('currentUser')
            if (savedUser) {
                currentUser = JSON.parse(savedUser)
                showDashboard(currentUser)
                loadUserData(currentUser.id)
            } else {
                showLoginScreen()
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeApp)

        // Event listeners
        googleSignInBtn.addEventListener('click', signInWithGoogle)
        signOutBtn.addEventListener('click', signOut)

        // Tab functionality
        const navTabs = document.querySelectorAll('.nav-tab')
        const tabContents = document.querySelectorAll('.tab-content')

        navTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab
                
                // Update active tab
                navTabs.forEach(t => {
                    t.classList.remove('active', 'border-blue-500', 'text-blue-600')
                    t.classList.add('border-transparent', 'text-gray-500')
                })
                tab.classList.add('active', 'border-blue-500', 'text-blue-600')
                tab.classList.remove('border-transparent', 'text-gray-500')
                
                // Show target content
                tabContents.forEach(content => {
                    content.classList.add('hidden')
                })
                document.getElementById(targetTab).classList.remove('hidden')
            })
        })

        // Initialize charts when dashboard loads
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d')
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue',
                        data: [45000, 52000, 48000, 61000, 55000, 67000],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R ' + value.toLocaleString()
                                }
                            }
                        }
                    }
                }
            })

            // Expense Chart
            const expenseCtx = document.getElementById('expenseChart').getContext('2d')
            new Chart(expenseCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Office Rent', 'Software', 'Marketing', 'Travel', 'Other'],
                    datasets: [{
                        data: [35000, 12000, 8000, 5000, 15000],
                        backgroundColor: [
                            'rgb(239, 68, 68)',
                            'rgb(245, 158, 11)',
                            'rgb(34, 197, 94)',
                            'rgb(168, 85, 247)',
                            'rgb(107, 114, 128)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            })
        }

        // Initialize charts after a short delay to ensure DOM is ready
        setTimeout(initializeCharts, 500)

        // AI Upload functionality
        document.getElementById('bankStatementUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0]
            if (!file) return

            // Show processing status
            document.getElementById('processingStatus').classList.remove('hidden')
            
            try {
                // Simulate AI processing delay
                await new Promise(resolve => setTimeout(resolve, 2000))
                
                const processedTransactions = await aiProcessor.processFile(file)
                
                // Hide processing status
                document.getElementById('processingStatus').classList.add('hidden')
                
                // Show processed transactions
                displayProcessedTransactions(processedTransactions)
                
                // Update AI insights
                updateAIInsights(processedTransactions)
                
            } catch (error) {
                console.error('Error processing file:', error)
                document.getElementById('processingStatus').classList.add('hidden')
                alert('Error processing file. Please check the format and try again.')
            }
        })

        function displayProcessedTransactions(transactions) {
            const tbody = document.getElementById('processedTransactionsBody')
            tbody.innerHTML = ''
            
            transactions.forEach((transaction, index) => {
                const row = document.createElement('tr')
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${transaction.amount > 0 ? 'text-green-600' : 'text-red-600'}">
                        ${currentConfig.symbol}${Math.abs(transaction.amount).toLocaleString()}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${transaction.confidence * 100}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${Math.round(transaction.confidence * 100)}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="approveTransaction(${index})" class="text-green-600 hover:text-green-800 mr-2">
                            <i class="fas fa-check"></i>
                        </button>
                        <button onclick="rejectTransaction(${index})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `
                tbody.appendChild(row)
            })
            
            document.getElementById('processedTransactions').classList.remove('hidden')
            window.pendingTransactions = transactions
        }

        function updateAIInsights(transactions) {
            const insights = document.getElementById('aiInsights')
            const totalTransactions = transactions.length
            const revenue = transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const expenses = Math.abs(transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const categories = [...new Set(transactions.map(t => t.category))]
            
            insights.innerHTML = `
                <div class="bg-blue-50 rounded-lg p-4">
                    <h4 class="font-medium text-blue-900 mb-2">Processing Complete!</h4>
                    <p class="text-sm text-blue-700">Processed ${totalTransactions} transactions</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <h4 class="font-medium text-green-900 mb-2">Revenue Detected</h4>
                    <p class="text-sm text-green-700">${currentConfig.symbol}${revenue.toLocaleString()} in income</p>
                </div>
                <div class="bg-red-50 rounded-lg p-4">
                    <h4 class="font-medium text-red-900 mb-2">Expenses Detected</h4>
                    <p class="text-sm text-red-700">${currentConfig.symbol}${expenses.toLocaleString()} in expenses</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-4">
                    <h4 class="font-medium text-purple-900 mb-2">Categories Found</h4>
                    <p class="text-sm text-purple-700">${categories.length} different categories identified</p>
                </div>
            `
        }

        // Tax Calendar functionality
        function initializeTaxCalendar() {
            const currentDate = new Date()
            const currentMonth = currentDate.getMonth()
            const currentYear = currentDate.getFullYear()
            
            updateCalendarDisplay(currentYear, currentMonth)
            updateUpcomingDeadlines()
        }

        function updateCalendarDisplay(year, month) {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December']
            
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`
            
            const firstDay = new Date(year, month, 1).getDay()
            const daysInMonth = new Date(year, month + 1, 0).getDate()
            
            const calendarGrid = document.getElementById('calendarGrid')
            calendarGrid.innerHTML = ''
            
            // Empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div')
                emptyCell.className = 'p-2'
                calendarGrid.appendChild(emptyCell)
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div')
                dayCell.className = 'p-2 text-center text-sm border border-gray-200 hover:bg-gray-50 cursor-pointer'
                dayCell.textContent = day
                
                // Check if this day has tax deadlines
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`
                const hasDeadline = currentConfig.taxDeadlines.some(deadline => deadline.date === dateStr)
                
                if (hasDeadline) {
                    dayCell.classList.add('bg-red-100', 'text-red-800', 'font-semibold')
                }
                
                calendarGrid.appendChild(dayCell)
            }
        }

        function updateUpcomingDeadlines() {
            const deadlinesContainer = document.getElementById('upcomingDeadlines')
            const today = new Date()
            
            const upcomingDeadlines = currentConfig.taxDeadlines
                .map(deadline => ({
                    ...deadline,
                    dateObj: new Date(deadline.date)
                }))
                .filter(deadline => deadline.dateObj >= today)
                .sort((a, b) => a.dateObj - b.dateObj)
                .slice(0, 5)
            
            deadlinesContainer.innerHTML = upcomingDeadlines.map(deadline => {
                const daysUntil = Math.ceil((deadline.dateObj - today) / (1000 * 60 * 60 * 24))
                const urgencyClass = daysUntil <= 7 ? 'bg-red-100 text-red-800' : 
                                   daysUntil <= 30 ? 'bg-yellow-100 text-yellow-800' : 
                                   'bg-green-100 text-green-800'
                
                return `
                    <div class="border border-gray-200 rounded-lg p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-gray-900">${deadline.name}</h4>
                            <span class="text-xs px-2 py-1 rounded-full ${urgencyClass}">
                                ${daysUntil} days
                            </span>
                        </div>
                        <p class="text-sm text-gray-600">${deadline.dateObj.toLocaleDateString()}</p>
                    </div>
                `
            }).join('')
        }

        // Calendar navigation
        let currentCalendarMonth = new Date().getMonth()
        let currentCalendarYear = new Date().getFullYear()

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentCalendarMonth--
            if (currentCalendarMonth < 0) {
                currentCalendarMonth = 11
                currentCalendarYear--
            }
            updateCalendarDisplay(currentCalendarYear, currentCalendarMonth)
        })

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentCalendarMonth++
            if (currentCalendarMonth > 11) {
                currentCalendarMonth = 0
                currentCalendarYear++
            }
            updateCalendarDisplay(currentCalendarYear, currentCalendarMonth)
        })

        // Initialize tax calendar when tab is shown
        document.querySelector('[data-tab="tax-calendar"]').addEventListener('click', () => {
            setTimeout(initializeTaxCalendar, 100)
        })

        // User data storage
        let currentUser = null
        let userData = {
            transactions: [],
            clients: [],
            stats: {
                totalRevenue: 0,
                activeClients: 0,
                pendingInvoices: 0,
                monthlyExpenses: 0
            }
        }

        // Load user data from localStorage
        function loadUserData(userId) {
            const stored = localStorage.getItem(`userData_${userId}`)
            if (stored) {
                userData = JSON.parse(stored)
            }
            updateAllDisplays()
        }

        // Save user data to localStorage
        function saveUserData(userId) {
            localStorage.setItem(`userData_${userId}`, JSON.stringify(userData))
        }

        // Currency formatting function
        function formatCurrency(amount) {
            return `${currentConfig.symbol}${Math.abs(amount).toLocaleString()}`
        }

        // Update all dashboard displays
        function updateAllDisplays() {
            updateStatsCards()
            updateTransactionTable()
            updateClientGrid()
            updateRecentActivity()
            updateQuickStats()
        }

        // Update stats cards
        function updateStatsCards() {
            const revenue = userData.transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const expenses = Math.abs(userData.transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const pendingAmount = userData.transactions.filter(t => t.status === 'Pending').reduce((sum, t) => sum + t.amount, 0)
            
            document.querySelector('.text-3xl.font-bold.text-gray-900').textContent = `R ${revenue.toLocaleString()}`
            document.querySelectorAll('.text-3xl.font-bold.text-gray-900')[1].textContent = userData.clients.length.toString()
            document.querySelectorAll('.text-3xl.font-bold.text-gray-900')[2].textContent = userData.transactions.filter(t => t.status === 'Pending').length.toString()
            document.querySelectorAll('.text-3xl.font-bold.text-gray-900')[3].textContent = `R ${expenses.toLocaleString()}`
        }

        // Update transaction table
        function updateTransactionTable() {
            const tbody = document.querySelector('#transactions tbody')
            tbody.innerHTML = ''
            
            userData.transactions.slice(0, 10).forEach(transaction => {
                const row = document.createElement('tr')
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.client}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${transaction.amount > 0 ? 'text-green-600' : 'text-red-600'}">
                        ${transaction.amount > 0 ? '+' : ''}R ${Math.abs(transaction.amount).toLocaleString()}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                            transaction.status === 'Paid' ? 'bg-green-100 text-green-800' : 
                            transaction.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-gray-100 text-gray-800'
                        }">${transaction.status}</span>
                    </td>
                `
                tbody.appendChild(row)
            })
        }

        // Update client grid
        function updateClientGrid() {
            const grid = document.querySelector('#clients .grid')
            grid.innerHTML = ''
            
            userData.clients.forEach(client => {
                const clientRevenue = userData.transactions
                    .filter(t => t.client === client.name && t.amount > 0)
                    .reduce((sum, t) => sum + t.amount, 0)
                
                const colors = ['blue', 'green', 'purple', 'orange', 'red']
                const color = colors[Math.floor(Math.random() * colors.length)]
                
                const clientCard = document.createElement('div')
                clientCard.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow'
                clientCard.innerHTML = `
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="bg-${color}-100 w-10 h-10 rounded-full flex items-center justify-center">
                            <i class="fas fa-building text-${color}-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">${client.name}</h4>
                            <p class="text-sm text-gray-500">${client.industry}</p>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <p class="text-gray-600"><i class="fas fa-envelope mr-2"></i>${client.email}</p>
                        <p class="text-gray-600"><i class="fas fa-phone mr-2"></i>${client.phone}</p>
                        <p class="text-green-600 font-medium"><i class="fas fa-dollar-sign mr-2"></i>R ${clientRevenue.toLocaleString()} YTD</p>
                    </div>
                `
                grid.appendChild(clientCard)
            })
        }

        // Update recent activity
        function updateRecentActivity() {
            const activityContainer = document.querySelector('#overview .space-y-4')
            activityContainer.innerHTML = ''
            
            userData.transactions.slice(0, 3).forEach(transaction => {
                const activity = document.createElement('div')
                activity.className = 'flex items-center space-x-4'
                activity.innerHTML = `
                    <div class="bg-${transaction.amount > 0 ? 'green' : 'red'}-100 p-2 rounded-full">
                        <i class="fas fa-${transaction.amount > 0 ? 'plus' : 'minus'} text-${transaction.amount > 0 ? 'green' : 'red'}-600"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">${transaction.description}</p>
                        <p class="text-sm text-gray-500">${transaction.client} â€¢ R ${Math.abs(transaction.amount).toLocaleString()}</p>
                    </div>
                    <span class="text-sm text-gray-500">${new Date(transaction.date).toLocaleDateString()}</span>
                `
                activityContainer.appendChild(activity)
            })
        }

        // Update quick stats
        function updateQuickStats() {
            const revenue = userData.transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const expenses = Math.abs(userData.transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const pending = userData.transactions.filter(t => t.status === 'Pending').reduce((sum, t) => sum + t.amount, 0)
            const profit = revenue - expenses
            
            const statsElements = document.querySelectorAll('#reports .font-semibold')
            if (statsElements.length >= 4) {
                statsElements[0].textContent = `R ${revenue.toLocaleString()}`
                statsElements[1].textContent = `R ${pending.toLocaleString()}`
                statsElements[2].textContent = `R ${expenses.toLocaleString()}`
                statsElements[3].textContent = `R ${profit.toLocaleString()}`
            }
        }

        // Add Transaction functionality
        document.getElementById('addTransactionBtn').addEventListener('click', function() {
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md">
                    <h3 class="text-lg font-semibold mb-4">Add Transaction</h3>
                    <form id="transactionForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <input type="text" id="description" class="w-full border border-gray-300 rounded-lg px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Amount (R)</label>
                                <input type="number" id="amount" class="w-full border border-gray-300 rounded-lg px-3 py-2" step="0.01" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Client</label>
                                <input type="text" id="client" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="status" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                    <option value="Paid">Paid</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Expense">Expense</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" id="cancelTransaction" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add Transaction</button>
                        </div>
                    </form>
                </div>
            `
            document.body.appendChild(modal)
            
            document.getElementById('cancelTransaction').addEventListener('click', () => {
                document.body.removeChild(modal)
            })
            
            document.getElementById('transactionForm').addEventListener('submit', function(e) {
                e.preventDefault()
                const description = document.getElementById('description').value
                const amount = parseFloat(document.getElementById('amount').value)
                const client = document.getElementById('client').value || 'General'
                const status = document.getElementById('status').value
                
                const transaction = {
                    id: Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    description,
                    amount: status === 'Expense' ? -Math.abs(amount) : amount,
                    client,
                    status
                }
                
                userData.transactions.unshift(transaction)
                saveUserData(currentUser.id)
                updateAllDisplays()
                document.body.removeChild(modal)
            })
        })

        // Add Client functionality
        document.getElementById('addClientBtn').addEventListener('click', function() {
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-md">
                    <h3 class="text-lg font-semibold mb-4">Add Client</h3>
                    <form id="clientForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                                <input type="text" id="clientName" class="w-full border border-gray-300 rounded-lg px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="clientEmail" class="w-full border border-gray-300 rounded-lg px-3 py-2" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                <input type="tel" id="clientPhone" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                                <input type="text" id="clientIndustry" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" id="cancelClient" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add Client</button>
                        </div>
                    </form>
                </div>
            `
            document.body.appendChild(modal)
            
            document.getElementById('cancelClient').addEventListener('click', () => {
                document.body.removeChild(modal)
            })
            
            document.getElementById('clientForm').addEventListener('submit', function(e) {
                e.preventDefault()
                const name = document.getElementById('clientName').value
                const email = document.getElementById('clientEmail').value
                const phone = document.getElementById('clientPhone').value || 'Not provided'
                const industry = document.getElementById('clientIndustry').value || 'Not specified'
                
                const client = {
                    id: Date.now(),
                    name,
                    email,
                    phone,
                    industry
                }
                
                userData.clients.push(client)
                saveUserData(currentUser.id)
                updateAllDisplays()
                document.body.removeChild(modal)
            })
        })

        // Report functionality
        document.getElementById('monthlyReportBtn').addEventListener('click', function() {
            const currentMonth = new Date().getMonth()
            const currentYear = new Date().getFullYear()
            
            const monthlyTransactions = userData.transactions.filter(t => {
                const transactionDate = new Date(t.date)
                return transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear
            })
            
            const revenue = monthlyTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const expenses = Math.abs(monthlyTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const profit = revenue - expenses
            
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg">
                    <h3 class="text-lg font-semibold mb-4">Monthly Financial Report</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span>Total Revenue:</span>
                            <span class="font-semibold text-green-600">R ${revenue.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Expenses:</span>
                            <span class="font-semibold text-red-600">R ${expenses.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="font-semibold">Net Profit:</span>
                            <span class="font-semibold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">R ${profit.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Transactions:</span>
                            <span>${monthlyTransactions.length}</span>
                        </div>
                    </div>
                    <button class="w-full mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" onclick="this.parentElement.parentElement.remove()">Close</button>
                </div>
            `
            document.body.appendChild(modal)
        })

        document.getElementById('taxSummaryBtn').addEventListener('click', function() {
            const currentYear = new Date().getFullYear()
            const yearlyTransactions = userData.transactions.filter(t => new Date(t.date).getFullYear() === currentYear)
            
            const totalIncome = yearlyTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const totalExpenses = Math.abs(yearlyTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const taxableIncome = Math.max(0, totalIncome - totalExpenses)
            const estimatedTax = taxableIncome * 0.28 // SA company tax rate
            
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg">
                    <h3 class="text-lg font-semibold mb-4">Tax Summary ${currentYear}</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span>Total Income:</span>
                            <span class="font-semibold">R ${totalIncome.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Total Expenses:</span>
                            <span class="font-semibold">R ${totalExpenses.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="font-semibold">Taxable Income:</span>
                            <span class="font-semibold">R ${taxableIncome.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold text-red-600">Estimated Tax (28%):</span>
                            <span class="font-semibold text-red-600">R ${estimatedTax.toLocaleString()}</span>
                        </div>
                    </div>
                    <button class="w-full mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" onclick="this.parentElement.parentElement.remove()">Close</button>
                </div>
            `
            document.body.appendChild(modal)
        })

        document.getElementById('clientRevenueBtn').addEventListener('click', function() {
            const clientRevenues = userData.clients.map(client => {
                const revenue = userData.transactions
                    .filter(t => t.client === client.name && t.amount > 0)
                    .reduce((sum, t) => sum + t.amount, 0)
                return { name: client.name, revenue }
            }).sort((a, b) => b.revenue - a.revenue)
            
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-full max-w-lg">
                    <h3 class="text-lg font-semibold mb-4">Client Revenue Report</h3>
                    <div class="space-y-3 max-h-64 overflow-y-auto">
                        ${clientRevenues.map(client => `
                            <div class="flex justify-between">
                                <span>${client.name}</span>
                                <span class="font-semibold">R ${client.revenue.toLocaleString()}</span>
                            </div>
                        `).join('')}
                    </div>
                    <button class="w-full mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" onclick="this.parentElement.parentElement.remove()">Close</button>
                </div>
            `
            document.body.appendChild(modal)
        })

        // User data management is now handled by the demo system

        // Button functionality
        document.getElementById('addTransactionBtn').addEventListener('click', function() {
            const description = prompt('Enter transaction description:')
            const amount = prompt('Enter amount (use - for expenses):')
            const client = prompt('Enter client name (optional):')
            
            if (description && amount) {
                addTransaction(description, parseFloat(amount), client || '-')
            }
        })

        document.getElementById('addClientBtn').addEventListener('click', function() {
            const name = prompt('Enter client name:')
            const email = prompt('Enter client email:')
            const phone = prompt('Enter client phone:')
            const industry = prompt('Enter client industry:')
            
            if (name && email) {
                addClient(name, email, phone, industry)
            }
        })

        document.getElementById('monthlyReportBtn').addEventListener('click', function() {
            generateMonthlyReport()
        })

        document.getElementById('taxSummaryBtn').addEventListener('click', function() {
            generateTaxSummary()
        })

        document.getElementById('clientRevenueBtn').addEventListener('click', function() {
            generateClientRevenue()
        })

        // Data management functions
        let transactions = JSON.parse(localStorage.getItem('transactions') || '[]')
        let clients = JSON.parse(localStorage.getItem('clients') || '[]')

        function addTransaction(description, amount, client) {
            const transaction = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                description,
                amount,
                client,
                status: amount > 0 ? 'Paid' : 'Expense'
            }
            
            transactions.unshift(transaction)
            localStorage.setItem('transactions', JSON.stringify(transactions))
            updateTransactionTable()
            updateDashboardStats()
            alert('Transaction added successfully!')
        }

        function addClient(name, email, phone, industry) {
            const client = {
                id: Date.now(),
                name,
                email,
                phone: phone || 'Not provided',
                industry: industry || 'Not specified',
                totalRevenue: 0
            }
            
            clients.push(client)
            localStorage.setItem('clients', JSON.stringify(clients))
            updateClientGrid()
            alert('Client added successfully!')
        }

        function updateTransactionTable() {
            const tbody = document.querySelector('#transactions tbody')
            tbody.innerHTML = ''
            
            transactions.slice(0, 10).forEach(transaction => {
                const row = document.createElement('tr')
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.client}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${transaction.amount > 0 ? 'text-green-600' : 'text-red-600'}">
                        ${transaction.amount > 0 ? '+' : ''}R ${Math.abs(transaction.amount).toLocaleString()}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                            transaction.status === 'Paid' ? 'bg-green-100 text-green-800' : 
                            transaction.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-gray-100 text-gray-800'
                        }">${transaction.status}</span>
                    </td>
                `
                tbody.appendChild(row)
            })
        }

        function updateClientGrid() {
            const grid = document.querySelector('#clients .grid')
            grid.innerHTML = ''
            
            clients.forEach(client => {
                const clientRevenue = transactions
                    .filter(t => t.client === client.name && t.amount > 0)
                    .reduce((sum, t) => sum + t.amount, 0)
                
                const clientCard = document.createElement('div')
                clientCard.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow'
                clientCard.innerHTML = `
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="bg-blue-100 w-10 h-10 rounded-full flex items-center justify-center">
                            <i class="fas fa-building text-blue-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-900">${client.name}</h4>
                            <p class="text-sm text-gray-500">${client.industry}</p>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <p class="text-gray-600"><i class="fas fa-envelope mr-2"></i>${client.email}</p>
                        <p class="text-gray-600"><i class="fas fa-phone mr-2"></i>${client.phone}</p>
                        <p class="text-green-600 font-medium"><i class="fas fa-dollar-sign mr-2"></i>R ${clientRevenue.toLocaleString()} YTD</p>
                    </div>
                `
                grid.appendChild(clientCard)
            })
        }

        function updateDashboardStats() {
            const totalRevenue = transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const totalExpenses = Math.abs(transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const netProfit = totalRevenue - totalExpenses
            
            // Update stats cards (you can expand this to update the actual DOM elements)
            console.log('Updated stats:', { totalRevenue, totalExpenses, netProfit })
        }

        function generateMonthlyReport() {
            const currentMonth = new Date().getMonth()
            const currentYear = new Date().getFullYear()
            
            const monthlyTransactions = transactions.filter(t => {
                const transactionDate = new Date(t.date)
                return transactionDate.getMonth() === currentMonth && transactionDate.getFullYear() === currentYear
            })
            
            const revenue = monthlyTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const expenses = Math.abs(monthlyTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const profit = revenue - expenses
            
            alert(`Monthly Financial Report\n\nRevenue: R ${revenue.toLocaleString()}\nExpenses: R ${expenses.toLocaleString()}\nNet Profit: R ${profit.toLocaleString()}\nTransactions: ${monthlyTransactions.length}`)
        }

        function generateTaxSummary() {
            const currentYear = new Date().getFullYear()
            const yearlyTransactions = transactions.filter(t => new Date(t.date).getFullYear() === currentYear)
            
            const totalIncome = yearlyTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0)
            const totalExpenses = Math.abs(yearlyTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0))
            const taxableIncome = totalIncome - totalExpenses
            const estimatedTax = taxableIncome * 0.28 // Rough SA tax estimate
            
            alert(`Tax Summary ${currentYear}\n\nTotal Income: R ${totalIncome.toLocaleString()}\nTotal Expenses: R ${totalExpenses.toLocaleString()}\nTaxable Income: R ${taxableIncome.toLocaleString()}\nEstimated Tax: R ${estimatedTax.toLocaleString()}`)
        }

        function generateClientRevenue() {
            const clientRevenues = clients.map(client => {
                const revenue = transactions
                    .filter(t => t.client === client.name && t.amount > 0)
                    .reduce((sum, t) => sum + t.amount, 0)
                return { name: client.name, revenue }
            }).sort((a, b) => b.revenue - a.revenue)
            
            let report = 'Client Revenue Report\n\n'
            clientRevenues.forEach(client => {
                report += `${client.name}: R ${client.revenue.toLocaleString()}\n`
            })
            
            alert(report)
        }

        // Initialize with user's data when dashboard loads
        function initializeUserData() {
            updateTransactionTable()
            updateClientGrid()
            updateDashboardStats()
        }

        // Demo system handles user state automatically
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96731a9930dbe2c5',t:'MTc1Mzg2MDEzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
