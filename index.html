<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Accounting Dashboard</title>


<!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
// Initialize Supabase client
const supabaseClient = supabase.createClient(
"https://ehpjupxbworwiepbuxkn.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVocGp1cHhid29yd2llcGJ1eGtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4Mzg5MTQsImV4cCI6MjA2OTQxNDkxNH0.uLGrwVrYn2hk_H5h40H731BvbwIRJPmt_AZTUFbtxH0"
);


// Google login
window.signInWithGoogle = async function () {
const { error } = await supabaseClient.auth.signInWithOAuth({
provider: 'google',
options: { redirectTo: "https://za-accounting-dashboard2.vercel.app" }
});
if (error) {
console.error("Google login error:", error);
alert("Sign-in error: " + error.message);
}
};


// Listen for login state changes
supabaseClient.auth.onAuthStateChange((event, session) => {
if (session) {
const user = session.user;
document.getElementById("userName").textContent = user.user_metadata.name;
document.getElementById("userAvatar").src = user.user_metadata.avatar_url;
document.getElementById("loginScreen")?.classList.add("hidden");
document.getElementById("dashboard")?.classList.remove("hidden");
loadCountries();
loadBusinessProfile();
}
});


// Load countries from Supabase
async function loadCountries() {
const { data, error } = await supabaseClient.from('countries').select('*');
if (error) { console.error("Error loading countries:", error); return; }
const selector = document.getElementById("countrySelector");
selector.innerHTML = '<option value="">-- Select Country --</option>';
data.forEach(c => {
const option = document.createElement("option");
option.value = c.code;
option.textContent = `${c.name} (${c.currency})`;
selector.appendChild(option);
});
}


// Save country selection
async function setUserCountry() {
const countryCode = document.getElementById("countrySelector").value;
const user = (await supabaseClient.auth.getUser()).data.user;
if (user) {
const { error } = await supabaseClient.from("profiles").upsert({
id: user.id,
country_code: countryCode
});
if (!error) loadDeadlines(countryCode);

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="glass-effect shadow-lg border-b border-gray-200 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="gradient-bg w-12 h-12 rounded-xl flex items-center justify-center">
                            <i class="fas fa-globe text-white text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Global Accounting</h1>
                            <p class="text-xs text-gray-500">Version 15.0 • <span id="countryFlag" class="text-lg"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="notifications" class="text-gray-500 hover:text-gray-700 transition-colors relative p-2 rounded-lg hover:bg-gray-100" title="Notifications">
                            <i class="fas fa-bell"></i>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                        </button>
                        <div id="userInfo" class="flex items-center space-x-3">
                            <img id="userAvatar" class="w-10 h-10 rounded-full border-2 border-blue-200" src="https://ui-avatars.com/api/?name=Demo+User&background=3b82f6&color=fff" alt="User">
                            <div class="hidden sm:block">
                                <span id="userName" class="text-gray-700 font-medium block">Demo User</span>
                                <span class="text-xs text-gray-500">Professional Plan</span>
                            </div>
                        </div>
                        <button id="signOut" class="text-gray-500 hover:text-gray-700 transition-colors p-2 rounded-lg hover:bg-gray-100" title="Sign Out">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
          <div id="businessProfile" class="glass-effect rounded-2xl p-6 mt-6 shadow-lg">
  <h2 class="text-xl font-bold mb-4 text-gray-800">Business Profile</h2>
  
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700">Business Name</label>
    <input type="text" id="businessName" class="w-full border-2 border-gray-300 rounded-xl py-2 px-3 focus:border-blue-500 focus:outline-none" placeholder="Enter your business name">
  </div>
  
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700">Tax Number</label>
    <input type="text" id="taxNumber" class="w-full border-2 border-gray-300 rounded-xl py-2 px-3 focus:border-blue-500 focus:outline-none" placeholder="Enter your tax/VAT number">
  </div>
  
  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700">Business Type</label>
    <select id="businessType" class="w-full border-2 border-gray-300 rounded-xl py-2 px-3 focus:border-blue-500 focus:outline-none">
      <option value="">-- Select Type --</option>
      <option value="sole_prop">Sole Proprietor</option>
      <option value="company">Company</option>
      <option value="partnership">Partnership</option>
      <option value="non_profit">Non-Profit</option>
    </select>
  </div>
  
  <button onclick="saveBusinessProfile()" class="gradient-bg text-white rounded-xl py-2 px-6 shadow-lg hover:opacity-90 transition">
    Save Profile
  </button>
  
  <div id="profileSavedMsg" class="text-green-600 text-sm mt-3 hidden">
    ✅ Profile saved successfully!
  </div>
</div>
        </header>

        <!-- Navigation -->
        <nav class="glass-effect shadow-sm sticky top-16 z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8 overflow-x-auto">
                    <button class="nav-tab active border-b-2 border-blue-500 py-4 px-1 text-blue-600 font-medium whitespace-nowrap transition-all duration-200" data-tab="overview">
                        <i class="fas fa-chart-line mr-2"></i>Overview
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap transition-all duration-200" data-tab="transactions">
                        <i class="fas fa-exchange-alt mr-2"></i>Transactions
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap transition-all duration-200" data-tab="clients">
                        <i class="fas fa-users mr-2"></i>Clients
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap transition-all duration-200" data-tab="invoices">
                        <i class="fas fa-file-invoice mr-2"></i>Invoices
                    </button>
                    <button class="nav-tab border-b-2 border-transparent py-4 px-1 text-gray-500 hover:text-gray-700 font-medium whitespace-nowrap transition-all duration-200" data-tab="reports">
                        <i class="fas fa-chart-bar mr-2"></i>Reports & Analytics
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content fade-in">
                <!-- Quick Actions -->
                <div class="mb-8 flex flex-wrap gap-3">
                    <button id="quickAddTransaction" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-lg card-hover">
                        <i class="fas fa-plus mr-2"></i>Quick Transaction
                    </button>
                    <button id="quickAddClient" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-lg card-hover">
                        <i class="fas fa-user-plus mr-2"></i>Add Client
                    </button>
                    <button id="generateInvoice" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-lg card-hover">
                        <i class="fas fa-file-invoice mr-2"></i>New Invoice
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Total Revenue</p>
                                <p class="text-3xl font-bold text-gray-900" id="totalRevenue">$127,450</p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>12.5% from last month
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-green-400 to-green-500 p-4 rounded-2xl">
                                <i class="fas fa-dollar-sign text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Active Clients</p>
                                <p class="text-3xl font-bold text-gray-900">24</p>
                                <p class="text-sm text-blue-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>3 new this month
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-blue-400 to-blue-500 p-4 rounded-2xl">
                                <i class="fas fa-users text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Pending Invoices</p>
                                <p class="text-3xl font-bold text-gray-900">7</p>
                                <p class="text-sm text-orange-600 mt-1">
                                    <i class="fas fa-clock mr-1"></i>$18,750 outstanding
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-orange-400 to-orange-500 p-4 rounded-2xl">
                                <i class="fas fa-file-invoice text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Monthly Expenses</p>
                                <p class="text-3xl font-bold text-gray-900">$32,180</p>
                                <p class="text-sm text-red-600 mt-1">
                                    <i class="fas fa-arrow-down mr-1"></i>8.2% from last month
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-red-400 to-red-500 p-4 rounded-2xl">
                                <i class="fas fa-credit-card text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Revenue Trend</h3>
                        <canvas id="revenueChart" width="400" height="200"></canvas>
                    </div>
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Expense Categories</h3>
                        <canvas id="expenseChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content hidden">
                <div class="glass-effect rounded-2xl shadow-lg border border-gray-100">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Transaction Management</h3>
                                <p class="text-sm text-gray-600">Track all your income and expenses with advanced filtering</p>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <input type="text" id="transactionSearch" placeholder="Search transactions..." class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                <select id="transactionFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                    <option value="all">All Transactions</option>
                                    <option value="income">Income Only</option>
                                    <option value="expense">Expenses Only</option>
                                    <option value="pending">Pending</option>
                                    <option value="this-month">This Month</option>
                                    <option value="last-month">Last Month</option>
                                </select>
                                <button id="addTransactionBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-lg">
                                    <i class="fas fa-plus mr-2"></i>Add Transaction
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" data-sort="date">
                                        Date <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" data-sort="description">
                                        Description <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" data-sort="client">
                                        Client <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors" data-sort="amount">
                                        Amount <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Transactions will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="p-6 border-t border-gray-200 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Showing <span id="transactionCount">0</span> transactions • Total: <span id="transactionTotal" class="font-semibold text-green-600">$0</span>
                        </div>
                        <div class="flex space-x-2">
                            <button id="exportTransactions" class="text-sm text-blue-600 hover:text-blue-800 transition-colors">
                                <i class="fas fa-download mr-1"></i>Export CSV
                            </button>
                            <button id="bulkActions" class="text-sm text-gray-600 hover:text-gray-800 transition-colors">
                                <i class="fas fa-tasks mr-1"></i>Bulk Actions
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="clients" class="tab-content hidden">
                <div class="glass-effect rounded-2xl shadow-lg border border-gray-100">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Client Management</h3>
                                <p class="text-sm text-gray-600">Manage your client relationships and track revenue per client</p>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <input type="text" id="clientSearch" placeholder="Search clients..." class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                <select id="clientFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                    <option value="all">All Clients</option>
                                    <option value="active">Active Clients</option>
                                    <option value="inactive">Inactive Clients</option>
                                    <option value="high-value">High Value</option>
                                    <option value="recent">Recently Added</option>
                                </select>
                                <button id="addClientBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-lg">
                                    <i class="fas fa-user-plus mr-2"></i>Add Client
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Client Stats -->
                    <div class="p-6 border-b border-gray-200">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600" id="totalClients">0</div>
                                <div class="text-sm text-gray-600">Total Clients</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600" id="activeClients">0</div>
                                <div class="text-sm text-gray-600">Active Clients</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600" id="totalClientRevenue">$0</div>
                                <div class="text-sm text-gray-600">Total Revenue</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-orange-600" id="avgClientValue">$0</div>
                                <div class="text-sm text-gray-600">Avg Client Value</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Client Cards Grid -->
                    <div class="p-6">
                        <div id="clientsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Client cards will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="p-6 border-t border-gray-200 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Showing <span id="clientCount">0</span> clients
                        </div>
                        <div class="flex space-x-2">
                            <button id="exportClients" class="text-sm text-blue-600 hover:text-blue-800 transition-colors">
                                <i class="fas fa-download mr-1"></i>Export CSV
                            </button>
                            <button id="clientBulkActions" class="text-sm text-gray-600 hover:text-gray-800 transition-colors">
                                <i class="fas fa-tasks mr-1"></i>Bulk Actions
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="invoices" class="tab-content hidden">
                <div class="glass-effect rounded-2xl shadow-lg border border-gray-100">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900">Invoice Management</h3>
                                <p class="text-sm text-gray-600">Create, track, and manage all your invoices with automated features</p>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <input type="text" id="invoiceSearch" placeholder="Search invoices..." class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                <select id="invoiceFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                    <option value="all">All Invoices</option>
                                    <option value="draft">Draft</option>
                                    <option value="sent">Sent</option>
                                    <option value="paid">Paid</option>
                                    <option value="overdue">Overdue</option>
                                    <option value="this-month">This Month</option>
                                </select>
                                <button id="addInvoiceBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-lg">
                                    <i class="fas fa-plus mr-2"></i>Create Invoice
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Invoice Stats -->
                    <div class="p-6 border-b border-gray-200">
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600" id="totalInvoices">0</div>
                                <div class="text-sm text-gray-600">Total Invoices</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600" id="paidInvoices">0</div>
                                <div class="text-sm text-gray-600">Paid</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-orange-600" id="pendingInvoices">0</div>
                                <div class="text-sm text-gray-600">Pending</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-red-600" id="overdueInvoices">0</div>
                                <div class="text-sm text-gray-600">Overdue</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600" id="totalInvoiceAmount">$0</div>
                                <div class="text-sm text-gray-600">Total Amount</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Invoice Cards Grid -->
                    <div class="p-6">
                        <div id="invoicesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Invoice cards will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="p-6 border-t border-gray-200 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            Showing <span id="invoiceCount">0</span> invoices • Outstanding: <span id="outstandingAmount" class="font-semibold text-orange-600">$0</span>
                        </div>
                        <div class="flex space-x-2">
                            <button id="exportInvoices" class="text-sm text-blue-600 hover:text-blue-800 transition-colors">
                                <i class="fas fa-download mr-1"></i>Export CSV
                            </button>
                            <button id="invoiceBulkActions" class="text-sm text-gray-600 hover:text-gray-800 transition-colors">
                                <i class="fas fa-tasks mr-1"></i>Bulk Actions
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports & Analytics Tab -->
            <div id="reports" class="tab-content hidden">
                <!-- Report Header -->
                <div class="mb-8">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">Reports & Analytics</h3>
                            <p class="text-sm text-gray-600">Comprehensive business intelligence and financial reporting</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <select id="reportPeriod" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                <option value="this-month">This Month</option>
                                <option value="last-month">Last Month</option>
                                <option value="this-quarter">This Quarter</option>
                                <option value="last-quarter">Last Quarter</option>
                                <option value="this-year">This Year</option>
                                <option value="last-year">Last Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <button id="exportReports" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-lg">
                                <i class="fas fa-download mr-2"></i>Export Reports
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Key Performance Indicators -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Net Profit</p>
                                <p class="text-3xl font-bold text-green-600" id="netProfit">$95,270</p>
                                <p class="text-sm text-green-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>18.5% margin
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-green-400 to-green-500 p-4 rounded-2xl">
                                <i class="fas fa-chart-line text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Cash Flow</p>
                                <p class="text-3xl font-bold text-blue-600" id="cashFlow">$42,850</p>
                                <p class="text-sm text-blue-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>Positive trend
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-blue-400 to-blue-500 p-4 rounded-2xl">
                                <i class="fas fa-water text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Avg Invoice Value</p>
                                <p class="text-3xl font-bold text-purple-600" id="avgInvoiceValue">$6,847</p>
                                <p class="text-sm text-purple-600 mt-1">
                                    <i class="fas fa-arrow-up mr-1"></i>12% increase
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-purple-400 to-purple-500 p-4 rounded-2xl">
                                <i class="fas fa-file-invoice-dollar text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Collection Rate</p>
                                <p class="text-3xl font-bold text-orange-600" id="collectionRate">94.2%</p>
                                <p class="text-sm text-orange-600 mt-1">
                                    <i class="fas fa-clock mr-1"></i>Avg 18 days
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-orange-400 to-orange-500 p-4 rounded-2xl">
                                <i class="fas fa-percentage text-white text-2xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="text-xl font-bold text-gray-900">Profit & Loss Trend</h4>
                            <select id="profitLossFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:border-blue-500 focus:outline-none">
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>
                        <canvas id="profitLossChart" width="400" height="250"></canvas>
                    </div>

                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="text-xl font-bold text-gray-900">Cash Flow Analysis</h4>
                            <button id="cashFlowDetails" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                <i class="fas fa-info-circle mr-1"></i>Details
                            </button>
                        </div>
                        <canvas id="cashFlowChart" width="400" height="250"></canvas>
                    </div>
                </div>

                <!-- Detailed Reports Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                    <!-- Revenue Breakdown -->
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <h4 class="text-xl font-bold text-gray-900 mb-6">Revenue by Client</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                    <span class="text-sm font-medium">Enterprise Corp</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-bold">$27,500</div>
                                    <div class="text-xs text-gray-500">35.2%</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <span class="text-sm font-medium">Acme Corp</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-bold">$15,750</div>
                                    <div class="text-xs text-gray-500">20.1%</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                                    <span class="text-sm font-medium">Global Solutions</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-bold">$12,400</div>
                                    <div class="text-xs text-gray-500">15.8%</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                                    <span class="text-sm font-medium">TechStart Inc</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-bold">$8,900</div>
                                    <div class="text-xs text-gray-500">11.4%</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                                    <span class="text-sm font-medium">Others</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-bold">$13,750</div>
                                    <div class="text-xs text-gray-500">17.5%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Expense Analysis -->
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <h4 class="text-xl font-bold text-gray-900 mb-6">Expense Categories</h4>
                        <canvas id="expenseAnalysisChart" width="300" height="300"></canvas>
                        <div class="mt-4 space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Largest Category:</span>
                                <span class="font-semibold">Office Rent (37%)</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Growth Rate:</span>
                                <span class="font-semibold text-red-600">-8.2%</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Budget Variance:</span>
                                <span class="font-semibold text-green-600">-$2,400</span>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <h4 class="text-xl font-bold text-gray-900 mb-6">Key Metrics</h4>
                        <div class="space-y-4">
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-blue-800">Revenue Growth</span>
                                    <span class="text-lg font-bold text-blue-600">+24.5%</span>
                                </div>
                                <div class="w-full bg-blue-200 rounded-full h-2 mt-2">
                                    <div class="bg-blue-600 h-2 rounded-full progress-bar" style="width: 75%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-green-800">Profit Margin</span>
                                    <span class="text-lg font-bold text-green-600">18.5%</span>
                                </div>
                                <div class="w-full bg-green-200 rounded-full h-2 mt-2">
                                    <div class="bg-green-600 h-2 rounded-full progress-bar" style="width: 85%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-purple-800">Client Retention</span>
                                    <span class="text-lg font-bold text-purple-600">96.2%</span>
                                </div>
                                <div class="w-full bg-purple-200 rounded-full h-2 mt-2">
                                    <div class="bg-purple-600 h-2 rounded-full progress-bar" style="width: 96%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-orange-800">Invoice Efficiency</span>
                                    <span class="text-lg font-bold text-orange-600">92.8%</span>
                                </div>
                                <div class="w-full bg-orange-200 rounded-full h-2 mt-2">
                                    <div class="bg-orange-600 h-2 rounded-full progress-bar" style="width: 93%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Financial Statements -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Profit & Loss Statement -->
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="text-xl font-bold text-gray-900">Profit & Loss Statement</h4>
                            <button id="downloadPL" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                <i class="fas fa-download mr-1"></i>Download
                            </button>
                        </div>
                        <div class="space-y-4">
                            <div class="border-b border-gray-200 pb-4">
                                <h5 class="font-semibold text-gray-900 mb-3">Revenue</h5>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Service Revenue</span>
                                        <span class="font-medium">$118,450</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Consulting Revenue</span>
                                        <span class="font-medium">$34,200</span>
                                    </div>
                                    <div class="flex justify-between text-sm font-bold border-t border-gray-100 pt-2">
                                        <span>Total Revenue</span>
                                        <span class="text-green-600">$152,650</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border-b border-gray-200 pb-4">
                                <h5 class="font-semibold text-gray-900 mb-3">Expenses</h5>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Office Rent</span>
                                        <span class="font-medium">$12,000</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Software & Tools</span>
                                        <span class="font-medium">$8,500</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Marketing</span>
                                        <span class="font-medium">$4,200</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Other Expenses</span>
                                        <span class="font-medium">$7,680</span>
                                    </div>
                                    <div class="flex justify-between text-sm font-bold border-t border-gray-100 pt-2">
                                        <span>Total Expenses</span>
                                        <span class="text-red-600">$32,380</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-bold text-green-800">Net Profit</span>
                                    <span class="text-2xl font-bold text-green-600">$120,270</span>
                                </div>
                                <div class="text-sm text-green-700 mt-1">Profit Margin: 78.8%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tax Summary -->
                    <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="text-xl font-bold text-gray-900">Tax Summary</h4>
                            <button id="downloadTax" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                <i class="fas fa-download mr-1"></i>Download
                            </button>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-semibold text-blue-800">Quarterly Tax Estimate</span>
                                    <span class="text-xl font-bold text-blue-600">$28,865</span>
                                </div>
                                <div class="text-sm text-blue-700">Based on current profit margins</div>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Federal Income Tax (24%)</span>
                                    <span class="font-medium">$18,945</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">State Income Tax (6%)</span>
                                    <span class="font-medium">$4,735</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Self-Employment Tax (15.3%)</span>
                                    <span class="font-medium">$5,185</span>
                                </div>
                            </div>
                            
                            <div class="border-t border-gray-200 pt-4">
                                <h5 class="font-semibold text-gray-900 mb-3">Deductible Expenses</h5>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Business Software</span>
                                        <span class="font-medium text-green-600">$8,500</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Office Expenses</span>
                                        <span class="font-medium text-green-600">$3,200</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Professional Services</span>
                                        <span class="font-medium text-green-600">$2,400</span>
                                    </div>
                                    <div class="flex justify-between text-sm font-bold border-t border-gray-100 pt-2">
                                        <span>Total Deductions</span>
                                        <span class="text-green-600">$14,100</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg p-4">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-orange-800">Tax Savings</span>
                                    <span class="text-lg font-bold text-orange-600">$3,384</span>
                                </div>
                                <div class="text-sm text-orange-700">From business deductions</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Business Intelligence -->
                <div class="glass-effect rounded-2xl shadow-lg p-6 border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="text-xl font-bold text-gray-900">Business Intelligence & Insights</h4>
                        <button id="generateInsights" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-lg">
                            <i class="fas fa-brain mr-2"></i>Generate AI Insights
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Recommendations -->
                        <div class="space-y-4">
                            <h5 class="font-semibold text-gray-900">💡 Recommendations</h5>
                            <div class="space-y-3">
                                <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded">
                                    <div class="text-sm font-medium text-green-800">Increase Rates</div>
                                    <div class="text-xs text-green-700 mt-1">Your hourly rate is 15% below market average. Consider raising rates for new projects.</div>
                                </div>
                                <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded">
                                    <div class="text-sm font-medium text-blue-800">Diversify Services</div>
                                    <div class="text-xs text-blue-700 mt-1">85% of revenue comes from 2 clients. Consider expanding your service offerings.</div>
                                </div>
                                <div class="bg-purple-50 border-l-4 border-purple-400 p-3 rounded">
                                    <div class="text-sm font-medium text-purple-800">Optimize Cash Flow</div>
                                    <div class="text-xs text-purple-700 mt-1">Implement shorter payment terms to improve cash flow by an estimated 23%.</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Trends -->
                        <div class="space-y-4">
                            <h5 class="font-semibold text-gray-900">📈 Trends</h5>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <div class="text-sm font-medium">Revenue Growth</div>
                                        <div class="text-xs text-gray-600">Month over month</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-green-600">+24.5%</div>
                                        <div class="text-xs text-green-600">↗ Trending up</div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <div class="text-sm font-medium">Client Acquisition</div>
                                        <div class="text-xs text-gray-600">New clients per month</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-blue-600">3.2</div>
                                        <div class="text-xs text-blue-600">↗ Steady growth</div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <div class="text-sm font-medium">Expense Ratio</div>
                                        <div class="text-xs text-gray-600">Expenses vs revenue</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-lg font-bold text-orange-600">21.2%</div>
                                        <div class="text-xs text-green-600">↘ Improving</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Forecasts -->
                        <div class="space-y-4">
                            <h5 class="font-semibold text-gray-900">🔮 Forecasts</h5>
                            <div class="space-y-3">
                                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg">
                                    <div class="text-sm font-medium text-blue-800 mb-2">Next Quarter Revenue</div>
                                    <div class="text-2xl font-bold text-blue-600">$185,400</div>
                                    <div class="text-xs text-blue-700 mt-1">Based on current growth trends</div>
                                </div>
                                <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg">
                                    <div class="text-sm font-medium text-green-800 mb-2">Annual Profit Projection</div>
                                    <div class="text-2xl font-bold text-green-600">$425,800</div>
                                    <div class="text-xs text-green-700 mt-1">Confidence level: 87%</div>
                                </div>
                                <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg">
                                    <div class="text-sm font-medium text-purple-800 mb-2">Break-even Analysis</div>
                                    <div class="text-2xl font-bold text-purple-600">$28,500</div>
                                    <div class="text-xs text-purple-700 mt-1">Monthly revenue needed</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global Configuration
        let currentUser = { name: 'Demo User', email: 'demo@example.com' }
        let selectedCountry = 'US'
        let charts = {}
        let transactions = [
            {
                id: 1,
                date: '2024-01-15',
                description: 'Website Development - Phase 1',
                client: 'Acme Corp',
                amount: 5250.00,
                type: 'income',
                status: 'paid',
                category: 'Services'
            },
            {
                id: 2,
                date: '2024-01-14',
                description: 'Office Supplies - Stationery',
                client: 'General',
                amount: -127.50,
                type: 'expense',
                status: 'paid',
                category: 'Office Supplies'
            },
            {
                id: 3,
                date: '2024-01-13',
                description: 'Consulting Services - Q4 Strategy',
                client: 'TechStart Inc',
                amount: 3800.00,
                type: 'income',
                status: 'pending',
                category: 'Consulting'
            },
            {
                id: 4,
                date: '2024-01-12',
                description: 'Software Subscription - Adobe Creative',
                client: 'General',
                amount: -89.99,
                type: 'expense',
                status: 'paid',
                category: 'Software'
            },
            {
                id: 5,
                date: '2024-01-11',
                description: 'Logo Design Project',
                client: 'Global Solutions',
                amount: 1200.00,
                type: 'income',
                status: 'paid',
                category: 'Design'
            },
            {
                id: 6,
                date: '2024-01-10',
                description: 'Business Lunch - Client Meeting',
                client: 'General',
                amount: -85.50,
                type: 'expense',
                status: 'paid',
                category: 'Meals'
            }
        ]
        let filteredTransactions = [...transactions]
        
        let clients = [
            {
                id: 1,
                name: 'Acme Corp',
                email: 'contact@acmecorp.com',
                phone: '+1 (555) 123-4567',
                company: 'Acme Corporation',
                address: '123 Business Ave, New York, NY 10001',
                status: 'active',
                dateAdded: '2023-08-15',
                totalRevenue: 15750.00,
                projectsCompleted: 3,
                industry: 'Technology',
                notes: 'Long-term client with consistent projects'
            },
            {
                id: 2,
                name: 'TechStart Inc',
                email: 'hello@techstart.io',
                phone: '+1 (555) 987-6543',
                company: 'TechStart Inc',
                address: '456 Innovation Blvd, San Francisco, CA 94105',
                status: 'active',
                dateAdded: '2023-11-20',
                totalRevenue: 8900.00,
                projectsCompleted: 2,
                industry: 'Startup',
                notes: 'Fast-growing startup, potential for expansion'
            },
            {
                id: 3,
                name: 'Global Solutions',
                email: 'info@globalsolutions.com',
                phone: '+1 (555) 456-7890',
                company: 'Global Solutions Ltd',
                address: '789 Corporate Dr, Chicago, IL 60601',
                status: 'active',
                dateAdded: '2023-09-10',
                totalRevenue: 12400.00,
                projectsCompleted: 4,
                industry: 'Consulting',
                notes: 'Prefers detailed project documentation'
            },
            {
                id: 4,
                name: 'Creative Agency',
                email: 'team@creativeagency.com',
                phone: '+1 (555) 321-0987',
                company: 'Creative Agency Co',
                address: '321 Design St, Los Angeles, CA 90210',
                status: 'inactive',
                dateAdded: '2023-06-05',
                totalRevenue: 5200.00,
                projectsCompleted: 1,
                industry: 'Marketing',
                notes: 'Project completed, may return for future work'
            },
            {
                id: 5,
                name: 'Enterprise Corp',
                email: 'procurement@enterprise.com',
                phone: '+1 (555) 654-3210',
                company: 'Enterprise Corporation',
                address: '654 Enterprise Way, Boston, MA 02101',
                status: 'active',
                dateAdded: '2024-01-08',
                totalRevenue: 22500.00,
                projectsCompleted: 1,
                industry: 'Enterprise',
                notes: 'Large enterprise client, high-value projects'
            },
            {
                id: 6,
                name: 'Local Business',
                email: 'owner@localbiz.com',
                phone: '+1 (555) 789-0123',
                company: 'Local Business LLC',
                address: '987 Main St, Austin, TX 78701',
                status: 'active',
                dateAdded: '2023-12-15',
                totalRevenue: 3800.00,
                projectsCompleted: 2,
                industry: 'Retail',
                notes: 'Small business, budget-conscious'
            }
        ]
        let filteredClients = [...clients]
        
        let invoices = [
            {
                id: 1,
                invoiceNumber: 'INV-2024-001',
                clientId: 1,
                clientName: 'Acme Corp',
                dateIssued: '2024-01-15',
                dateDue: '2024-02-14',
                status: 'paid',
                items: [
                    { description: 'Website Development - Phase 1', quantity: 1, rate: 5000.00, amount: 5000.00 },
                    { description: 'Domain Setup & Configuration', quantity: 1, rate: 250.00, amount: 250.00 }
                ],
                subtotal: 5250.00,
                taxRate: 10,
                taxAmount: 525.00,
                total: 5775.00,
                notes: 'Thank you for your business!',
                paymentTerms: 'Net 30',
                datePaid: '2024-02-10'
            },
            {
                id: 2,
                invoiceNumber: 'INV-2024-002',
                clientId: 2,
                clientName: 'TechStart Inc',
                dateIssued: '2024-01-20',
                dateDue: '2024-02-19',
                status: 'sent',
                items: [
                    { description: 'Consulting Services - Q4 Strategy', quantity: 20, rate: 150.00, amount: 3000.00 },
                    { description: 'Market Research Report', quantity: 1, rate: 800.00, amount: 800.00 }
                ],
                subtotal: 3800.00,
                taxRate: 10,
                taxAmount: 380.00,
                total: 4180.00,
                notes: 'Payment due within 30 days of invoice date.',
                paymentTerms: 'Net 30',
                datePaid: null
            },
            {
                id: 3,
                invoiceNumber: 'INV-2024-003',
                clientId: 3,
                clientName: 'Global Solutions',
                dateIssued: '2024-01-10',
                dateDue: '2024-01-25',
                status: 'overdue',
                items: [
                    { description: 'Logo Design & Branding', quantity: 1, rate: 1200.00, amount: 1200.00 }
                ],
                subtotal: 1200.00,
                taxRate: 10,
                taxAmount: 120.00,
                total: 1320.00,
                notes: 'Includes 3 revision rounds.',
                paymentTerms: 'Net 15',
                datePaid: null
            },
            {
                id: 4,
                invoiceNumber: 'INV-2024-004',
                clientId: 5,
                clientName: 'Enterprise Corp',
                dateIssued: '2024-01-25',
                dateDue: '2024-02-24',
                status: 'draft',
                items: [
                    { description: 'Enterprise Software Development', quantity: 100, rate: 200.00, amount: 20000.00 },
                    { description: 'Project Management', quantity: 40, rate: 125.00, amount: 5000.00 }
                ],
                subtotal: 25000.00,
                taxRate: 10,
                taxAmount: 2500.00,
                total: 27500.00,
                notes: 'Large enterprise project with milestone payments.',
                paymentTerms: 'Net 30',
                datePaid: null
            },
            {
                id: 5,
                invoiceNumber: 'INV-2024-005',
                clientId: 6,
                clientName: 'Local Business',
                dateIssued: '2024-01-18',
                dateDue: '2024-02-17',
                status: 'sent',
                items: [
                    { description: 'Website Redesign', quantity: 1, rate: 2500.00, amount: 2500.00 },
                    { description: 'SEO Optimization', quantity: 1, rate: 800.00, amount: 800.00 }
                ],
                subtotal: 3300.00,
                taxRate: 8,
                taxAmount: 264.00,
                total: 3564.00,
                notes: 'Includes mobile responsive design.',
                paymentTerms: 'Net 30',
                datePaid: null
            },
            {
                id: 6,
                invoiceNumber: 'INV-2024-006',
                clientId: 1,
                clientName: 'Acme Corp',
                dateIssued: '2024-01-28',
                dateDue: '2024-02-27',
                status: 'paid',
                items: [
                    { description: 'Website Development - Phase 2', quantity: 1, rate: 4500.00, amount: 4500.00 },
                    { description: 'Content Management System', quantity: 1, rate: 1500.00, amount: 1500.00 }
                ],
                subtotal: 6000.00,
                taxRate: 10,
                taxAmount: 600.00,
                total: 6600.00,
                notes: 'Phase 2 completion with CMS integration.',
                paymentTerms: 'Net 30',
                datePaid: '2024-02-25'
            }
        ]
        let filteredInvoices = [...invoices]

        // Country configurations
        const countryConfigs = {
            US: { currency: 'USD', symbol: '$', flag: '🇺🇸' },
            GB: { currency: 'GBP', symbol: '£', flag: '🇬🇧' },
            EU: { currency: 'EUR', symbol: '€', flag: '🇪🇺' },
            ZA: { currency: 'ZAR', symbol: 'R', flag: '🇿🇦' },
            AU: { currency: 'AUD', symbol: 'A$', flag: '🇦🇺' },
            CA: { currency: 'CAD', symbol: 'C$', flag: '🇨🇦' },
            IN: { currency: 'INR', symbol: '₹', flag: '🇮🇳' },
            SG: { currency: 'SGD', symbol: 'S$', flag: '🇸🇬' },
            JP: { currency: 'JPY', symbol: '¥', flag: '🇯🇵' },
            BR: { currency: 'BRL', symbol: 'R$', flag: '🇧🇷' }
        }

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div')
            notification.className = `notification ${type}`
            notification.textContent = message
            document.body.appendChild(notification)
            
            setTimeout(() => notification.classList.add('show'), 100)
            setTimeout(() => {
                notification.classList.remove('show')
                setTimeout(() => document.body.removeChild(notification), 300)
            }, 4000)
        }

        function formatCurrency(amount) {
            const config = countryConfigs[selectedCountry]
            return `${config.symbol}${Math.abs(amount).toLocaleString()}`
        }

        // Authentication Functions
        function handleLogin(event) {
            event.preventDefault()
            const email = document.getElementById('loginEmail').value
            const password = document.getElementById('loginPassword').value
            
            if (!email || !password) {
                showNotification('Please fill in all fields.', 'error')
                return
            }
            
            document.getElementById('loginSpinner').classList.remove('hidden')
            document.getElementById('loginBtnText').classList.add('hidden')
            
            setTimeout(() => {
                selectedCountry = document.getElementById('countrySelector').value
                showDashboard()
                showNotification('Welcome back! Successfully signed in.', 'success')
            }, 1500)
        }

        function handleDemoLogin() {
            selectedCountry = document.getElementById('countrySelector').value
            showDashboard()
            showNotification('Welcome to the demo! All features are fully functional.', 'success')
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden')
            document.getElementById('dashboard').classList.remove('hidden')
            
            // Update country flag
            const config = countryConfigs[selectedCountry]
            document.getElementById('countryFlag').textContent = config.flag
            
            initializeCharts()
            renderTransactions()
            renderClients()
        }

        function signOut() {
            document.getElementById('dashboard').classList.add('hidden')
            document.getElementById('loginScreen').classList.remove('hidden')
            showNotification('Successfully signed out.', 'info')
        }

        // Tab Navigation
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden')
            })
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active', 'border-blue-500', 'text-blue-600')
                tab.classList.add('border-transparent', 'text-gray-500')
            })
            
            document.getElementById(tabName).classList.remove('hidden')
            document.getElementById(tabName).classList.add('fade-in')
            
            const activeTab = document.querySelector(`[data-tab="${tabName}"]`)
            activeTab.classList.add('active', 'border-blue-500', 'text-blue-600')
            activeTab.classList.remove('border-transparent', 'text-gray-500')
            
            // Initialize reports charts when reports tab is accessed
            if (tabName === 'reports' && !charts.profitLoss) {
                setTimeout(initializeReportsCharts, 100)
            }
        }

        // Transaction Functions
        function renderTransactions() {
            const tbody = document.getElementById('transactionsTableBody')
            tbody.innerHTML = ''
            
            filteredTransactions.forEach(transaction => {
                const row = document.createElement('tr')
                row.className = 'hover:bg-gray-50 transition-colors'
                
                const statusClass = transaction.status === 'paid' ? 'bg-green-100 text-green-800' : 
                                  transaction.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                                  'bg-red-100 text-red-800'
                
                const amountClass = transaction.amount > 0 ? 'text-green-600' : 'text-red-600'
                const amountPrefix = transaction.amount > 0 ? '+' : ''
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.client}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${amountClass}">${amountPrefix}${formatCurrency(transaction.amount)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="editTransaction(${transaction.id})" class="text-blue-600 hover:text-blue-800 mr-2 transition-colors" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteTransaction(${transaction.id})" class="text-red-600 hover:text-red-800 transition-colors" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `
                tbody.appendChild(row)
            })
            
            updateTransactionSummary()
        }
        
        function updateTransactionSummary() {
            const count = filteredTransactions.length
            const total = filteredTransactions.reduce((sum, t) => sum + t.amount, 0)
            
            document.getElementById('transactionCount').textContent = count
            document.getElementById('transactionTotal').textContent = formatCurrency(total)
            document.getElementById('transactionTotal').className = `font-semibold ${total >= 0 ? 'text-green-600' : 'text-red-600'}`
        }
        
        function filterTransactions() {
            const searchTerm = document.getElementById('transactionSearch').value.toLowerCase()
            const filterType = document.getElementById('transactionFilter').value
            
            filteredTransactions = transactions.filter(transaction => {
                const matchesSearch = transaction.description.toLowerCase().includes(searchTerm) ||
                                    transaction.client.toLowerCase().includes(searchTerm)
                
                let matchesFilter = true
                switch(filterType) {
                    case 'income':
                        matchesFilter = transaction.type === 'income'
                        break
                    case 'expense':
                        matchesFilter = transaction.type === 'expense'
                        break
                    case 'pending':
                        matchesFilter = transaction.status === 'pending'
                        break
                    case 'this-month':
                        const thisMonth = new Date().getMonth()
                        const transactionMonth = new Date(transaction.date).getMonth()
                        matchesFilter = thisMonth === transactionMonth
                        break
                    case 'last-month':
                        const lastMonth = new Date().getMonth() - 1
                        const transactionLastMonth = new Date(transaction.date).getMonth()
                        matchesFilter = lastMonth === transactionLastMonth
                        break
                }
                
                return matchesSearch && matchesFilter
            })
            
            renderTransactions()
        }
        
        function addTransaction() {
            createTransactionModal()
        }
        
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id)
            if (transaction) {
                createTransactionModal(transaction)
            }
        }
        
        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id)
                filterTransactions()
                showNotification('Transaction deleted successfully!', 'success')
            }
        }
        
        function createTransactionModal(transaction = null) {
            const isEdit = transaction !== null
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in'
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md mx-4 bounce-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">${isEdit ? 'Edit' : 'Add'} Transaction</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <form id="transactionForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="transactionDate" value="${transaction?.date || new Date().toISOString().split('T')[0]}" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <input type="text" id="transactionDescription" value="${transaction?.description || ''}" placeholder="Enter description" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Client</label>
                            <input type="text" id="transactionClient" value="${transaction?.client || ''}" placeholder="Enter client name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="transactionType" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                                    <option value="income" ${transaction?.type === 'income' ? 'selected' : ''}>Income</option>
                                    <option value="expense" ${transaction?.type === 'expense' ? 'selected' : ''}>Expense</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                                <input type="number" id="transactionAmount" value="${transaction ? Math.abs(transaction.amount) : ''}" placeholder="0.00" step="0.01" min="0" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select id="transactionCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                                    <option value="Services" ${transaction?.category === 'Services' ? 'selected' : ''}>Services</option>
                                    <option value="Consulting" ${transaction?.category === 'Consulting' ? 'selected' : ''}>Consulting</option>
                                    <option value="Design" ${transaction?.category === 'Design' ? 'selected' : ''}>Design</option>
                                    <option value="Software" ${transaction?.category === 'Software' ? 'selected' : ''}>Software</option>
                                    <option value="Office Supplies" ${transaction?.category === 'Office Supplies' ? 'selected' : ''}>Office Supplies</option>
                                    <option value="Meals" ${transaction?.category === 'Meals' ? 'selected' : ''}>Meals</option>
                                    <option value="Travel" ${transaction?.category === 'Travel' ? 'selected' : ''}>Travel</option>
                                    <option value="Other" ${transaction?.category === 'Other' ? 'selected' : ''}>Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="transactionStatus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                                    <option value="paid" ${transaction?.status === 'paid' ? 'selected' : ''}>Paid</option>
                                    <option value="pending" ${transaction?.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="overdue" ${transaction?.status === 'overdue' ? 'selected' : ''}>Overdue</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="flex-1 border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-2 px-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200">
                                ${isEdit ? 'Update' : 'Add'} Transaction
                            </button>
                        </div>
                    </form>
                </div>
            `
            
            document.body.appendChild(modal)
            
            // Handle form submission
            document.getElementById('transactionForm').addEventListener('submit', function(e) {
                e.preventDefault()
                saveTransaction(transaction?.id)
            })
        }
        
        function saveTransaction(editId = null) {
            const formData = {
                date: document.getElementById('transactionDate').value,
                description: document.getElementById('transactionDescription').value,
                client: document.getElementById('transactionClient').value,
                type: document.getElementById('transactionType').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                category: document.getElementById('transactionCategory').value,
                status: document.getElementById('transactionStatus').value
            }
            
            // Adjust amount based on type
            if (formData.type === 'expense') {
                formData.amount = -Math.abs(formData.amount)
            }
            
            if (editId) {
                // Update existing transaction
                const index = transactions.findIndex(t => t.id === editId)
                if (index !== -1) {
                    transactions[index] = { ...transactions[index], ...formData }
                    showNotification('Transaction updated successfully!', 'success')
                }
            } else {
                // Add new transaction
                const newTransaction = {
                    id: Math.max(...transactions.map(t => t.id)) + 1,
                    ...formData
                }
                transactions.unshift(newTransaction)
                showNotification('Transaction added successfully!', 'success')
            }
            
            closeModal()
            filterTransactions()
        }
        
        function closeModal() {
            const modal = document.querySelector('.fixed.inset-0')
            if (modal) {
                document.body.removeChild(modal)
            }
        }
        
        function exportTransactions() {
            const csvContent = [
                ['Date', 'Description', 'Client', 'Amount', 'Type', 'Category', 'Status'],
                ...filteredTransactions.map(t => [
                    t.date,
                    t.description,
                    t.client,
                    t.amount,
                    t.type,
                    t.category,
                    t.status
                ])
            ].map(row => row.join(',')).join('\n')
            
            const blob = new Blob([csvContent], { type: 'text/csv' })
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = `transactions_${new Date().toISOString().split('T')[0]}.csv`
            a.click()
            window.URL.revokeObjectURL(url)
            
            showNotification('Transactions exported successfully!', 'success')
        }

        // Invoice Management Functions
        function renderInvoices() {
            const grid = document.getElementById('invoicesGrid')
            grid.innerHTML = ''
            
            filteredInvoices.forEach(invoice => {
                const card = document.createElement('div')
                card.className = 'glass-effect rounded-xl shadow-lg border border-gray-100 p-6 card-hover'
                
                const statusColors = {
                    'draft': 'bg-gray-100 text-gray-800',
                    'sent': 'bg-blue-100 text-blue-800',
                    'paid': 'bg-green-100 text-green-800',
                    'overdue': 'bg-red-100 text-red-800'
                }
                
                const isOverdue = invoice.status !== 'paid' && new Date(invoice.dateDue) < new Date()
                const actualStatus = isOverdue ? 'overdue' : invoice.status
                
                const daysUntilDue = Math.ceil((new Date(invoice.dateDue) - new Date()) / (1000 * 60 * 60 * 24))
                const dueDateText = invoice.status === 'paid' ? 
                    `Paid on ${new Date(invoice.datePaid).toLocaleDateString()}` :
                    daysUntilDue < 0 ? 
                        `${Math.abs(daysUntilDue)} days overdue` :
                        `Due in ${daysUntilDue} days`
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h4 class="font-bold text-gray-900 text-lg">${invoice.invoiceNumber}</h4>
                            <p class="text-sm text-gray-600">${invoice.clientName}</p>
                        </div>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${statusColors[actualStatus]}">${actualStatus.charAt(0).toUpperCase() + actualStatus.slice(1)}</span>
                    </div>
                    
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Amount:</span>
                            <span class="font-semibold text-gray-900">${formatCurrency(invoice.total)}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Issued:</span>
                            <span class="text-gray-900">${new Date(invoice.dateIssued).toLocaleDateString()}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Due Date:</span>
                            <span class="text-gray-900 ${actualStatus === 'overdue' ? 'text-red-600 font-semibold' : ''}">${new Date(invoice.dateDue).toLocaleDateString()}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Status:</span>
                            <span class="text-gray-900 ${actualStatus === 'overdue' ? 'text-red-600' : actualStatus === 'paid' ? 'text-green-600' : ''}">${dueDateText}</span>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4">
                        <div class="text-xs text-gray-500 mb-3">
                            ${invoice.items.length} item${invoice.items.length !== 1 ? 's' : ''} • ${invoice.paymentTerms}
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="viewInvoice(${invoice.id})" class="flex-1 bg-blue-50 text-blue-600 py-2 px-3 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium">
                                <i class="fas fa-eye mr-1"></i>View
                            </button>
                            ${invoice.status === 'draft' ? `
                                <button onclick="editInvoice(${invoice.id})" class="flex-1 bg-gray-50 text-gray-600 py-2 px-3 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                            ` : `
                                <button onclick="duplicateInvoice(${invoice.id})" class="flex-1 bg-gray-50 text-gray-600 py-2 px-3 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            `}
                            <button onclick="downloadInvoicePDF(${invoice.id})" class="bg-green-50 text-green-600 py-2 px-3 rounded-lg hover:bg-green-100 transition-colors text-sm">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                `
                
                grid.appendChild(card)
            })
            
            updateInvoiceStats()
        }
        
        function updateInvoiceStats() {
            const totalInvoices = invoices.length
            const paidInvoices = invoices.filter(i => i.status === 'paid').length
            const pendingInvoices = invoices.filter(i => i.status === 'sent').length
            const overdueInvoices = invoices.filter(i => i.status !== 'paid' && new Date(i.dateDue) < new Date()).length
            const totalAmount = invoices.reduce((sum, i) => sum + i.total, 0)
            const outstandingAmount = invoices.filter(i => i.status !== 'paid').reduce((sum, i) => sum + i.total, 0)
            
            document.getElementById('totalInvoices').textContent = totalInvoices
            document.getElementById('paidInvoices').textContent = paidInvoices
            document.getElementById('pendingInvoices').textContent = pendingInvoices
            document.getElementById('overdueInvoices').textContent = overdueInvoices
            document.getElementById('totalInvoiceAmount').textContent = formatCurrency(totalAmount)
            document.getElementById('invoiceCount').textContent = filteredInvoices.length
            document.getElementById('outstandingAmount').textContent = formatCurrency(outstandingAmount)
        }
        
        function filterInvoices() {
            const searchTerm = document.getElementById('invoiceSearch').value.toLowerCase()
            const filterType = document.getElementById('invoiceFilter').value
            
            filteredInvoices = invoices.filter(invoice => {
                const matchesSearch = invoice.invoiceNumber.toLowerCase().includes(searchTerm) ||
                                    invoice.clientName.toLowerCase().includes(searchTerm) ||
                                    invoice.items.some(item => item.description.toLowerCase().includes(searchTerm))
                
                let matchesFilter = true
                switch(filterType) {
                    case 'draft':
                        matchesFilter = invoice.status === 'draft'
                        break
                    case 'sent':
                        matchesFilter = invoice.status === 'sent'
                        break
                    case 'paid':
                        matchesFilter = invoice.status === 'paid'
                        break
                    case 'overdue':
                        matchesFilter = invoice.status !== 'paid' && new Date(invoice.dateDue) < new Date()
                        break
                    case 'this-month':
                        const thisMonth = new Date().getMonth()
                        const invoiceMonth = new Date(invoice.dateIssued).getMonth()
                        matchesFilter = thisMonth === invoiceMonth
                        break
                }
                
                return matchesSearch && matchesFilter
            })
            
            renderInvoices()
        }
        
        function addInvoice() {
            createInvoiceModal()
        }
        
        function editInvoice(id) {
            const invoice = invoices.find(i => i.id === id)
            if (invoice) {
                createInvoiceModal(invoice)
            }
        }
        
        function viewInvoice(id) {
            const invoice = invoices.find(i => i.id === id)
            if (invoice) {
                createInvoiceViewModal(invoice)
            }
        }
        
        function duplicateInvoice(id) {
            const invoice = invoices.find(i => i.id === id)
            if (invoice) {
                const newInvoice = {
                    ...invoice,
                    id: Math.max(...invoices.map(i => i.id)) + 1,
                    invoiceNumber: generateInvoiceNumber(),
                    dateIssued: new Date().toISOString().split('T')[0],
                    dateDue: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'draft',
                    datePaid: null
                }
                invoices.unshift(newInvoice)
                filterInvoices()
                showNotification('Invoice duplicated successfully!', 'success')
            }
        }
        
        function generateInvoiceNumber() {
            const year = new Date().getFullYear()
            const existingNumbers = invoices
                .filter(i => i.invoiceNumber.startsWith(`INV-${year}-`))
                .map(i => parseInt(i.invoiceNumber.split('-')[2]))
            const nextNumber = Math.max(...existingNumbers, 0) + 1
            return `INV-${year}-${nextNumber.toString().padStart(3, '0')}`
        }
        
        function downloadInvoicePDF(id) {
            const invoice = invoices.find(i => i.id === id)
            if (invoice) {
                generateInvoicePDF(invoice)
            }
        }
        
        function generateInvoicePDF(invoice) {
            // Create a new window for the PDF content
            const printWindow = window.open('', '_blank')
            
            const pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice ${invoice.invoiceNumber}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; color: #333; }
                        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #3b82f6; padding-bottom: 20px; }
                        .company-info { flex: 1; }
                        .company-name { font-size: 24px; font-weight: bold; color: #3b82f6; margin-bottom: 5px; }
                        .invoice-info { text-align: right; }
                        .invoice-number { font-size: 28px; font-weight: bold; color: #3b82f6; }
                        .client-info { margin: 30px 0; }
                        .section-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; color: #374151; }
                        .items-table { width: 100%; border-collapse: collapse; margin: 30px 0; }
                        .items-table th, .items-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
                        .items-table th { background-color: #f9fafb; font-weight: bold; }
                        .items-table .amount { text-align: right; }
                        .totals { margin-top: 30px; }
                        .totals-table { width: 300px; margin-left: auto; }
                        .totals-table td { padding: 8px 12px; border: none; }
                        .totals-table .total-row { font-weight: bold; font-size: 18px; border-top: 2px solid #3b82f6; }
                        .notes { margin-top: 40px; padding: 20px; background-color: #f9fafb; border-radius: 8px; }
                        .footer { margin-top: 40px; text-align: center; color: #6b7280; font-size: 12px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="company-info">
                            <div class="company-name">Global Accounting</div>
                            <div>Professional Services</div>
                            <div>contact@globalaccounting.com</div>
                            <div>+1 (555) 123-4567</div>
                        </div>
                        <div class="invoice-info">
                            <div class="invoice-number">INVOICE</div>
                            <div style="font-size: 18px; margin-top: 5px;">${invoice.invoiceNumber}</div>
                        </div>
                    </div>
                    
                    <div class="client-info">
                        <div class="section-title">Bill To:</div>
                        <div style="font-weight: bold; font-size: 16px;">${invoice.clientName}</div>
                        <div>Date Issued: ${new Date(invoice.dateIssued).toLocaleDateString()}</div>
                        <div>Due Date: ${new Date(invoice.dateDue).toLocaleDateString()}</div>
                        <div>Payment Terms: ${invoice.paymentTerms}</div>
                    </div>
                    
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th style="text-align: center;">Qty</th>
                                <th class="amount">Rate</th>
                                <th class="amount">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${invoice.items.map(item => `
                                <tr>
                                    <td>${item.description}</td>
                                    <td style="text-align: center;">${item.quantity}</td>
                                    <td class="amount">${formatCurrency(item.rate)}</td>
                                    <td class="amount">${formatCurrency(item.amount)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="totals">
                        <table class="totals-table">
                            <tr>
                                <td>Subtotal:</td>
                                <td class="amount">${formatCurrency(invoice.subtotal)}</td>
                            </tr>
                            <tr>
                                <td>Tax (${invoice.taxRate}%):</td>
                                <td class="amount">${formatCurrency(invoice.taxAmount)}</td>
                            </tr>
                            <tr class="total-row">
                                <td>Total:</td>
                                <td class="amount">${formatCurrency(invoice.total)}</td>
                            </tr>
                        </table>
                    </div>
                    
                    ${invoice.notes ? `
                        <div class="notes">
                            <div class="section-title">Notes:</div>
                            <div>${invoice.notes}</div>
                        </div>
                    ` : ''}
                    
                    <div class="footer">
                        <p>Thank you for your business!</p>
                        <p>This invoice was generated on ${new Date().toLocaleDateString()}</p>
                    </div>
                </body>
                </html>
            `
            
            printWindow.document.write(pdfContent)
            printWindow.document.close()
            
            // Wait for content to load, then print
            setTimeout(() => {
                printWindow.print()
                showNotification('Invoice PDF generated successfully!', 'success')
            }, 500)
        }
        
        function exportInvoices() {
            const csvContent = [
                ['Invoice Number', 'Client', 'Date Issued', 'Due Date', 'Status', 'Subtotal', 'Tax', 'Total', 'Date Paid'],
                ...filteredInvoices.map(i => [
                    i.invoiceNumber,
                    i.clientName,
                    i.dateIssued,
                    i.dateDue,
                    i.status,
                    i.subtotal,
                    i.taxAmount,
                    i.total,
                    i.datePaid || 'Not Paid'
                ])
            ].map(row => row.join(',')).join('\n')
            
            const blob = new Blob([csvContent], { type: 'text/csv' })
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = `invoices_${new Date().toISOString().split('T')[0]}.csv`
            a.click()
            window.URL.revokeObjectURL(url)
            
            showNotification('Invoices exported successfully!', 'success')
        }
        
        function createInvoiceModal(invoice = null) {
            const isEdit = invoice !== null
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in'
            
            const clientOptions = clients.map(c => 
                `<option value="${c.id}" ${invoice?.clientId === c.id ? 'selected' : ''}>${c.name} - ${c.company}</option>`
            ).join('')
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto bounce-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-900">${isEdit ? 'Edit' : 'Create'} Invoice</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="invoiceForm" class="space-y-6">
                        <!-- Invoice Header -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Invoice Number</label>
                                <input type="text" id="invoiceNumber" value="${invoice?.invoiceNumber || generateInvoiceNumber()}" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date Issued *</label>
                                <input type="date" id="invoiceDateIssued" value="${invoice?.dateIssued || new Date().toISOString().split('T')[0]}" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Due Date *</label>
                                <input type="date" id="invoiceDateDue" value="${invoice?.dateDue || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                            </div>
                        </div>
                        
                        <!-- Client Selection -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Client *</label>
                                <select id="invoiceClient" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                                    <option value="">Select a client...</option>
                                    ${clientOptions}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Payment Terms</label>
                                <select id="invoicePaymentTerms" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none">
                                    <option value="Net 15" ${invoice?.paymentTerms === 'Net 15' ? 'selected' : ''}>Net 15</option>
                                    <option value="Net 30" ${invoice?.paymentTerms === 'Net 30' ? 'selected' : ''}>Net 30</option>
                                    <option value="Net 60" ${invoice?.paymentTerms === 'Net 60' ? 'selected' : ''}>Net 60</option>
                                    <option value="Due on Receipt" ${invoice?.paymentTerms === 'Due on Receipt' ? 'selected' : ''}>Due on Receipt</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Invoice Items -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-lg font-semibold text-gray-900">Invoice Items</h4>
                                <button type="button" onclick="addInvoiceItem()" class="bg-blue-50 text-blue-600 px-3 py-2 rounded-lg hover:bg-blue-100 transition-colors text-sm">
                                    <i class="fas fa-plus mr-1"></i>Add Item
                                </button>
                            </div>
                            <div id="invoiceItems" class="space-y-3">
                                <!-- Items will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Totals -->
                        <div class="border-t border-gray-200 pt-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                                    <textarea id="invoiceNotes" rows="4" placeholder="Add any notes or terms..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none">${invoice?.notes || ''}</textarea>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700">Subtotal:</span>
                                        <span id="invoiceSubtotal" class="font-semibold">${formatCurrency(0)}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-gray-700">Tax:</span>
                                            <input type="number" id="invoiceTaxRate" value="${invoice?.taxRate || 10}" min="0" max="100" step="0.1" class="w-16 border border-gray-300 rounded px-2 py-1 text-sm focus:border-blue-500 focus:outline-none" onchange="calculateInvoiceTotals()">
                                            <span class="text-gray-700 text-sm">%</span>
                                        </div>
                                        <span id="invoiceTaxAmount" class="font-semibold">${formatCurrency(0)}</span>
                                    </div>
                                    <div class="flex justify-between items-center text-lg font-bold border-t border-gray-200 pt-3">
                                        <span>Total:</span>
                                        <span id="invoiceTotal">${formatCurrency(0)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3 pt-6 border-t border-gray-200">
                            <button type="button" onclick="closeModal()" class="flex-1 border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                                Cancel
                            </button>
                            <button type="button" onclick="saveInvoice('draft', ${invoice?.id || 'null'})" class="flex-1 bg-gray-50 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-100 transition-colors">
                                Save as Draft
                            </button>
                            <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 px-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200">
                                ${isEdit ? 'Update & Send' : 'Create & Send'}
                            </button>
                        </div>
                    </form>
                </div>
            `
            
            document.body.appendChild(modal)
            
            // Initialize items
            if (invoice && invoice.items) {
                invoice.items.forEach(item => addInvoiceItem(item))
            } else {
                addInvoiceItem()
            }
            
            calculateInvoiceTotals()
            
            // Handle form submission
            document.getElementById('invoiceForm').addEventListener('submit', function(e) {
                e.preventDefault()
                saveInvoice('sent', invoice?.id)
            })
        }
        
        function createInvoiceViewModal(invoice) {
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in'
            
            const statusColors = {
                'draft': 'bg-gray-100 text-gray-800',
                'sent': 'bg-blue-100 text-blue-800',
                'paid': 'bg-green-100 text-green-800',
                'overdue': 'bg-red-100 text-red-800'
            }
            
            const isOverdue = invoice.status !== 'paid' && new Date(invoice.dateDue) < new Date()
            const actualStatus = isOverdue ? 'overdue' : invoice.status
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto bounce-in">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-900">${invoice.invoiceNumber}</h3>
                            <span class="px-3 py-1 text-sm font-semibold rounded-full ${statusColors[actualStatus]} mt-2 inline-block">${actualStatus.charAt(0).toUpperCase() + actualStatus.slice(1)}</span>
                        </div>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Invoice Details -->
                        <div class="space-y-6">
                            <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                <h4 class="font-bold text-gray-900 mb-3">Invoice Information</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Invoice Number:</span>
                                        <span class="font-medium">${invoice.invoiceNumber}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Date Issued:</span>
                                        <span class="font-medium">${new Date(invoice.dateIssued).toLocaleDateString()}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Due Date:</span>
                                        <span class="font-medium ${actualStatus === 'overdue' ? 'text-red-600' : ''}">${new Date(invoice.dateDue).toLocaleDateString()}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Payment Terms:</span>
                                        <span class="font-medium">${invoice.paymentTerms}</span>
                                    </div>
                                    ${invoice.datePaid ? `
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Date Paid:</span>
                                            <span class="font-medium text-green-600">${new Date(invoice.datePaid).toLocaleDateString()}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                <h4 class="font-bold text-gray-900 mb-3">Client Information</h4>
                                <div class="text-sm">
                                    <div class="font-medium text-lg">${invoice.clientName}</div>
                                </div>
                            </div>
                            
                            ${invoice.notes ? `
                                <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                    <h4 class="font-bold text-gray-900 mb-3">Notes</h4>
                                    <p class="text-sm text-gray-700">${invoice.notes}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <!-- Invoice Items & Totals -->
                        <div class="space-y-6">
                            <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                <h4 class="font-bold text-gray-900 mb-4">Invoice Items</h4>
                                <div class="space-y-3">
                                    ${invoice.items.map(item => `
                                        <div class="flex justify-between items-start py-2 border-b border-gray-100 last:border-b-0">
                                            <div class="flex-1">
                                                <div class="font-medium text-sm">${item.description}</div>
                                                <div class="text-xs text-gray-500">${item.quantity} × ${formatCurrency(item.rate)}</div>
                                            </div>
                                            <div class="font-semibold text-sm">${formatCurrency(item.amount)}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                <h4 class="font-bold text-gray-900 mb-4">Invoice Totals</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Subtotal:</span>
                                        <span class="font-medium">${formatCurrency(invoice.subtotal)}</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Tax (${invoice.taxRate}%):</span>
                                        <span class="font-medium">${formatCurrency(invoice.taxAmount)}</span>
                                    </div>
                                    <div class="flex justify-between text-lg font-bold border-t border-gray-200 pt-2">
                                        <span>Total:</span>
                                        <span class="text-blue-600">${formatCurrency(invoice.total)}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3 pt-6 mt-6 border-t border-gray-200">
                        ${invoice.status === 'draft' ? `
                            <button onclick="editInvoice(${invoice.id}); closeModal();" class="bg-blue-50 text-blue-600 py-2 px-4 rounded-lg hover:bg-blue-100 transition-colors">
                                <i class="fas fa-edit mr-2"></i>Edit Invoice
                            </button>
                        ` : ''}
                        <button onclick="downloadInvoicePDF(${invoice.id})" class="bg-green-50 text-green-600 py-2 px-4 rounded-lg hover:bg-green-100 transition-colors">
                            <i class="fas fa-download mr-2"></i>Download PDF
                        </button>
                        <button onclick="duplicateInvoice(${invoice.id}); closeModal();" class="bg-gray-50 text-gray-600 py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="fas fa-copy mr-2"></i>Duplicate
                        </button>
                        <button onclick="closeModal()" class="flex-1 border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `
            
            document.body.appendChild(modal)
        }
        
        function addInvoiceItem(item = null) {
            const itemsContainer = document.getElementById('invoiceItems')
            const itemDiv = document.createElement('div')
            itemDiv.className = 'invoice-item grid grid-cols-1 md:grid-cols-12 gap-3 p-4 border border-gray-200 rounded-lg'
            
            itemDiv.innerHTML = `
                <div class="md:col-span-5">
                    <input type="text" class="item-description w-full border border-gray-300 rounded px-3 py-2 text-sm focus:border-blue-500 focus:outline-none" placeholder="Description" value="${item?.description || ''}" onchange="calculateInvoiceTotals()">
                </div>
                <div class="md:col-span-2">
                    <input type="number" class="item-quantity w-full border border-gray-300 rounded px-3 py-2 text-sm focus:border-blue-500 focus:outline-none" placeholder="Qty" value="${item?.quantity || 1}" min="1" onchange="calculateInvoiceTotals()">
                </div>
                <div class="md:col-span-2">
                    <input type="number" class="item-rate w-full border border-gray-300 rounded px-3 py-2 text-sm focus:border-blue-500 focus:outline-none" placeholder="Rate" value="${item?.rate || ''}" step="0.01" min="0" onchange="calculateInvoiceTotals()">
                </div>
                <div class="md:col-span-2">
                    <input type="text" class="item-amount w-full border border-gray-300 rounded px-3 py-2 text-sm bg-gray-50" placeholder="Amount" readonly>
                </div>
                <div class="md:col-span-1">
                    <button type="button" onclick="removeInvoiceItem(this)" class="w-full bg-red-50 text-red-600 py-2 px-3 rounded hover:bg-red-100 transition-colors text-sm">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `
            
            itemsContainer.appendChild(itemDiv)
            calculateInvoiceTotals()
        }
        
        function removeInvoiceItem(button) {
            button.closest('.invoice-item').remove()
            calculateInvoiceTotals()
        }
        
        function calculateInvoiceTotals() {
            const items = document.querySelectorAll('.invoice-item')
            let subtotal = 0
            
            items.forEach(item => {
                const quantity = parseFloat(item.querySelector('.item-quantity').value) || 0
                const rate = parseFloat(item.querySelector('.item-rate').value) || 0
                const amount = quantity * rate
                
                item.querySelector('.item-amount').value = formatCurrency(amount)
                subtotal += amount
            })
            
            const taxRate = parseFloat(document.getElementById('invoiceTaxRate').value) || 0
            const taxAmount = subtotal * (taxRate / 100)
            const total = subtotal + taxAmount
            
            document.getElementById('invoiceSubtotal').textContent = formatCurrency(subtotal)
            document.getElementById('invoiceTaxAmount').textContent = formatCurrency(taxAmount)
            document.getElementById('invoiceTotal').textContent = formatCurrency(total)
        }
        
        function saveInvoice(status, editId = null) {
            const clientId = parseInt(document.getElementById('invoiceClient').value)
            const client = clients.find(c => c.id === clientId)
            
            if (!client) {
                showNotification('Please select a client.', 'error')
                return
            }
            
            const items = []
            document.querySelectorAll('.invoice-item').forEach(item => {
                const description = item.querySelector('.item-description').value
                const quantity = parseFloat(item.querySelector('.item-quantity').value) || 0
                const rate = parseFloat(item.querySelector('.item-rate').value) || 0
                
                if (description && quantity > 0 && rate > 0) {
                    items.push({
                        description,
                        quantity,
                        rate,
                        amount: quantity * rate
                    })
                }
            })
            
            if (items.length === 0) {
                showNotification('Please add at least one invoice item.', 'error')
                return
            }
            
            const subtotal = items.reduce((sum, item) => sum + item.amount, 0)
            const taxRate = parseFloat(document.getElementById('invoiceTaxRate').value) || 0
            const taxAmount = subtotal * (taxRate / 100)
            const total = subtotal + taxAmount
            
            const formData = {
                invoiceNumber: document.getElementById('invoiceNumber').value,
                clientId: clientId,
                clientName: client.name,
                dateIssued: document.getElementById('invoiceDateIssued').value,
                dateDue: document.getElementById('invoiceDateDue').value,
                status: status,
                items: items,
                subtotal: subtotal,
                taxRate: taxRate,
                taxAmount: taxAmount,
                total: total,
                notes: document.getElementById('invoiceNotes').value,
                paymentTerms: document.getElementById('invoicePaymentTerms').value,
                datePaid: null
            }
            
            if (editId) {
                // Update existing invoice
                const index = invoices.findIndex(i => i.id === editId)
                if (index !== -1) {
                    invoices[index] = { ...invoices[index], ...formData }
                    showNotification(`Invoice ${status === 'draft' ? 'saved as draft' : 'updated and sent'}!`, 'success')
                }
            } else {
                // Add new invoice
                const newInvoice = {
                    id: Math.max(...invoices.map(i => i.id)) + 1,
                    ...formData
                }
                invoices.unshift(newInvoice)
                showNotification(`Invoice ${status === 'draft' ? 'saved as draft' : 'created and sent'}!`, 'success')
            }
            
            closeModal()
            filterInvoices()
        }

        // Client Management Functions
        function renderClients() {
            const grid = document.getElementById('clientsGrid')
            grid.innerHTML = ''
            
            filteredClients.forEach(client => {
                const card = document.createElement('div')
                card.className = 'glass-effect rounded-xl shadow-lg border border-gray-100 p-6 card-hover'
                
                const statusClass = client.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                const industryColors = {
                    'Technology': 'bg-blue-100 text-blue-800',
                    'Startup': 'bg-purple-100 text-purple-800',
                    'Consulting': 'bg-indigo-100 text-indigo-800',
                    'Marketing': 'bg-pink-100 text-pink-800',
                    'Enterprise': 'bg-orange-100 text-orange-800',
                    'Retail': 'bg-green-100 text-green-800'
                }
                
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                                ${client.name.charAt(0)}
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900">${client.name}</h4>
                                <p class="text-sm text-gray-600">${client.company}</p>
                            </div>
                        </div>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${client.status.charAt(0).toUpperCase() + client.status.slice(1)}</span>
                    </div>
                    
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-envelope w-4 mr-2"></i>
                            <span class="truncate">${client.email}</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-phone w-4 mr-2"></i>
                            <span>${client.phone}</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-building w-4 mr-2"></i>
                            <span class="px-2 py-1 text-xs rounded-full ${industryColors[client.industry] || 'bg-gray-100 text-gray-800'}">${client.industry}</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="text-center">
                            <div class="text-lg font-bold text-green-600">${formatCurrency(client.totalRevenue)}</div>
                            <div class="text-xs text-gray-600">Total Revenue</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-blue-600">${client.projectsCompleted}</div>
                            <div class="text-xs text-gray-600">Projects</div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="viewClient(${client.id})" class="flex-1 bg-blue-50 text-blue-600 py-2 px-3 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium">
                            <i class="fas fa-eye mr-1"></i>View
                        </button>
                        <button onclick="editClient(${client.id})" class="flex-1 bg-gray-50 text-gray-600 py-2 px-3 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium">
                            <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                        <button onclick="deleteClient(${client.id})" class="bg-red-50 text-red-600 py-2 px-3 rounded-lg hover:bg-red-100 transition-colors text-sm">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `
                
                grid.appendChild(card)
            })
            
            updateClientStats()
        }
        
        function updateClientStats() {
            const totalClients = clients.length
            const activeClients = clients.filter(c => c.status === 'active').length
            const totalRevenue = clients.reduce((sum, c) => sum + c.totalRevenue, 0)
            const avgValue = totalClients > 0 ? totalRevenue / totalClients : 0
            
            document.getElementById('totalClients').textContent = totalClients
            document.getElementById('activeClients').textContent = activeClients
            document.getElementById('totalClientRevenue').textContent = formatCurrency(totalRevenue)
            document.getElementById('avgClientValue').textContent = formatCurrency(avgValue)
            document.getElementById('clientCount').textContent = filteredClients.length
        }
        
        function filterClients() {
            const searchTerm = document.getElementById('clientSearch').value.toLowerCase()
            const filterType = document.getElementById('clientFilter').value
            
            filteredClients = clients.filter(client => {
                const matchesSearch = client.name.toLowerCase().includes(searchTerm) ||
                                    client.company.toLowerCase().includes(searchTerm) ||
                                    client.email.toLowerCase().includes(searchTerm) ||
                                    client.industry.toLowerCase().includes(searchTerm)
                
                let matchesFilter = true
                switch(filterType) {
                    case 'active':
                        matchesFilter = client.status === 'active'
                        break
                    case 'inactive':
                        matchesFilter = client.status === 'inactive'
                        break
                    case 'high-value':
                        matchesFilter = client.totalRevenue > 10000
                        break
                    case 'recent':
                        const oneMonthAgo = new Date()
                        oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1)
                        matchesFilter = new Date(client.dateAdded) > oneMonthAgo
                        break
                }
                
                return matchesSearch && matchesFilter
            })
            
            renderClients()
        }
        
        function addClient() {
            createClientModal()
        }
        
        function editClient(id) {
            const client = clients.find(c => c.id === id)
            if (client) {
                createClientModal(client)
            }
        }
        
        function viewClient(id) {
            const client = clients.find(c => c.id === id)
            if (client) {
                createClientViewModal(client)
            }
        }
        
        function deleteClient(id) {
            if (confirm('Are you sure you want to delete this client? This action cannot be undone.')) {
                clients = clients.filter(c => c.id !== id)
                filterClients()
                showNotification('Client deleted successfully!', 'success')
            }
        }
        
        function createClientModal(client = null) {
            const isEdit = client !== null
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in'
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto bounce-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">${isEdit ? 'Edit' : 'Add'} Client</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <form id="clientForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Client Name *</label>
                                <input type="text" id="clientName" value="${client?.name || ''}" placeholder="Enter client name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Company *</label>
                                <input type="text" id="clientCompany" value="${client?.company || ''}" placeholder="Enter company name" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                                <input type="email" id="clientEmail" value="${client?.email || ''}" placeholder="Enter email address" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                <input type="tel" id="clientPhone" value="${client?.phone || ''}" placeholder="Enter phone number" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                            <textarea id="clientAddress" rows="2" placeholder="Enter full address" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none">${client?.address || ''}</textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                                <select id="clientIndustry" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                                    <option value="Technology" ${client?.industry === 'Technology' ? 'selected' : ''}>Technology</option>
                                    <option value="Startup" ${client?.industry === 'Startup' ? 'selected' : ''}>Startup</option>
                                    <option value="Consulting" ${client?.industry === 'Consulting' ? 'selected' : ''}>Consulting</option>
                                    <option value="Marketing" ${client?.industry === 'Marketing' ? 'selected' : ''}>Marketing</option>
                                    <option value="Enterprise" ${client?.industry === 'Enterprise' ? 'selected' : ''}>Enterprise</option>
                                    <option value="Retail" ${client?.industry === 'Retail' ? 'selected' : ''}>Retail</option>
                                    <option value="Healthcare" ${client?.industry === 'Healthcare' ? 'selected' : ''}>Healthcare</option>
                                    <option value="Finance" ${client?.industry === 'Finance' ? 'selected' : ''}>Finance</option>
                                    <option value="Education" ${client?.industry === 'Education' ? 'selected' : ''}>Education</option>
                                    <option value="Other" ${client?.industry === 'Other' ? 'selected' : ''}>Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="clientStatus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none" required>
                                    <option value="active" ${client?.status === 'active' ? 'selected' : ''}>Active</option>
                                    <option value="inactive" ${client?.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Projects Completed</label>
                                <input type="number" id="clientProjects" value="${client?.projectsCompleted || 0}" min="0" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                            <textarea id="clientNotes" rows="3" placeholder="Add any notes about this client..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:border-blue-500 focus:outline-none">${client?.notes || ''}</textarea>
                        </div>
                        <div class="flex space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="flex-1 border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-2 px-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200">
                                ${isEdit ? 'Update' : 'Add'} Client
                            </button>
                        </div>
                    </form>
                </div>
            `
            
            document.body.appendChild(modal)
            
            // Handle form submission
            document.getElementById('clientForm').addEventListener('submit', function(e) {
                e.preventDefault()
                saveClient(client?.id)
            })
        }
        
        function createClientViewModal(client) {
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in'
            
            const clientTransactions = transactions.filter(t => t.client === client.name && t.type === 'income')
            const recentTransactions = clientTransactions.slice(0, 5)
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto bounce-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-900">${client.name}</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Client Info -->
                        <div class="lg:col-span-2 space-y-6">
                            <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                <h4 class="font-bold text-gray-900 mb-3">Contact Information</h4>
                                <div class="space-y-2">
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-building w-5 mr-3 text-gray-400"></i>
                                        <span class="font-medium mr-2">Company:</span>
                                        <span>${client.company}</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-envelope w-5 mr-3 text-gray-400"></i>
                                        <span class="font-medium mr-2">Email:</span>
                                        <a href="mailto:${client.email}" class="text-blue-600 hover:text-blue-800">${client.email}</a>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-phone w-5 mr-3 text-gray-400"></i>
                                        <span class="font-medium mr-2">Phone:</span>
                                        <a href="tel:${client.phone}" class="text-blue-600 hover:text-blue-800">${client.phone}</a>
                                    </div>
                                    <div class="flex items-start text-sm">
                                        <i class="fas fa-map-marker-alt w-5 mr-3 text-gray-400 mt-0.5"></i>
                                        <span class="font-medium mr-2">Address:</span>
                                        <span>${client.address}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                <h4 class="font-bold text-gray-900 mb-3">Recent Transactions</h4>
                                ${recentTransactions.length > 0 ? `
                                    <div class="space-y-2">
                                        ${recentTransactions.map(t => `
                                            <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                                <div>
                                                    <div class="font-medium text-sm">${t.description}</div>
                                                    <div class="text-xs text-gray-500">${t.date}</div>
                                                </div>
                                                <div class="text-green-600 font-medium">${formatCurrency(t.amount)}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : '<p class="text-gray-500 text-sm">No transactions found</p>'}
                            </div>
                            
                            ${client.notes ? `
                                <div class="glass-effect rounded-xl p-4 border border-gray-100">
                                    <h4 class="font-bold text-gray-900 mb-3">Notes</h4>
                                    <p class="text-sm text-gray-700">${client.notes}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <!-- Stats -->
                        <div class="space-y-4">
                            <div class="glass-effect rounded-xl p-4 border border-gray-100 text-center">
                                <div class="text-2xl font-bold text-green-600">${formatCurrency(client.totalRevenue)}</div>
                                <div class="text-sm text-gray-600">Total Revenue</div>
                            </div>
                            <div class="glass-effect rounded-xl p-4 border border-gray-100 text-center">
                                <div class="text-2xl font-bold text-blue-600">${client.projectsCompleted}</div>
                                <div class="text-sm text-gray-600">Projects Completed</div>
                            </div>
                            <div class="glass-effect rounded-xl p-4 border border-gray-100 text-center">
                                <div class="text-2xl font-bold text-purple-600">${client.industry}</div>
                                <div class="text-sm text-gray-600">Industry</div>
                            </div>
                            <div class="glass-effect rounded-xl p-4 border border-gray-100 text-center">
                                <div class="text-2xl font-bold ${client.status === 'active' ? 'text-green-600' : 'text-gray-600'}">${client.status.charAt(0).toUpperCase() + client.status.slice(1)}</div>
                                <div class="text-sm text-gray-600">Status</div>
                            </div>
                            <div class="glass-effect rounded-xl p-4 border border-gray-100 text-center">
                                <div class="text-sm font-bold text-gray-900">${new Date(client.dateAdded).toLocaleDateString()}</div>
                                <div class="text-sm text-gray-600">Client Since</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3 pt-6 mt-6 border-t border-gray-200">
                        <button onclick="editClient(${client.id}); closeModal();" class="bg-blue-50 text-blue-600 py-2 px-4 rounded-lg hover:bg-blue-100 transition-colors">
                            <i class="fas fa-edit mr-2"></i>Edit Client
                        </button>
                        <button onclick="closeModal()" class="flex-1 border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `
            
            document.body.appendChild(modal)
        }
        
        function saveClient(editId = null) {
            const formData = {
                name: document.getElementById('clientName').value,
                company: document.getElementById('clientCompany').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                address: document.getElementById('clientAddress').value,
                industry: document.getElementById('clientIndustry').value,
                status: document.getElementById('clientStatus').value,
                projectsCompleted: parseInt(document.getElementById('clientProjects').value) || 0,
                notes: document.getElementById('clientNotes').value
            }
            
            if (editId) {
                // Update existing client
                const index = clients.findIndex(c => c.id === editId)
                if (index !== -1) {
                    clients[index] = { ...clients[index], ...formData }
                    showNotification('Client updated successfully!', 'success')
                }
            } else {
                // Add new client
                const newClient = {
                    id: Math.max(...clients.map(c => c.id)) + 1,
                    ...formData,
                    dateAdded: new Date().toISOString().split('T')[0],
                    totalRevenue: 0
                }
                clients.unshift(newClient)
                showNotification('Client added successfully!', 'success')
            }
            
            closeModal()
            filterClients()
        }
        
        function exportClients() {
            const csvContent = [
                ['Name', 'Company', 'Email', 'Phone', 'Industry', 'Status', 'Total Revenue', 'Projects', 'Date Added'],
                ...filteredClients.map(c => [
                    c.name,
                    c.company,
                    c.email,
                    c.phone,
                    c.industry,
                    c.status,
                    c.totalRevenue,
                    c.projectsCompleted,
                    c.dateAdded
                ])
            ].map(row => row.join(',')).join('\n')
            
            const blob = new Blob([csvContent], { type: 'text/csv' })
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = `clients_${new Date().toISOString().split('T')[0]}.csv`
            a.click()
            window.URL.revokeObjectURL(url)
            
            showNotification('Clients exported successfully!', 'success')
        }

        // Chart Initialization
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d')
            charts.revenue = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    datasets: [{
                        label: 'Revenue',
                        data: [32000, 38000, 42000, 45000, 48000, 52000],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value)
                                }
                            }
                        }
                    }
                }
            })

            // Expense Chart
            const expenseCtx = document.getElementById('expenseChart').getContext('2d')
            charts.expense = new Chart(expenseCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Software', 'Office Rent', 'Marketing', 'Travel', 'Utilities', 'Other'],
                    datasets: [{
                        data: [8500, 12000, 4200, 2800, 1500, 3180],
                        backgroundColor: [
                            'rgb(59, 130, 246)',
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)',
                            'rgb(168, 85, 247)',
                            'rgb(107, 114, 128)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: { padding: 20, usePointStyle: true }
                        }
                    }
                }
            })
        }

        // Advanced Reports Chart Initialization
        function initializeReportsCharts() {
            // Profit & Loss Chart
            const profitLossCtx = document.getElementById('profitLossChart').getContext('2d')
            charts.profitLoss = new Chart(profitLossCtx, {
                type: 'bar',
                data: {
                    labels: ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                    datasets: [
                        {
                            label: 'Revenue',
                            data: [45000, 52000, 48000, 58000, 62000, 67000],
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: 'rgb(34, 197, 94)',
                            borderWidth: 1
                        },
                        {
                            label: 'Expenses',
                            data: [28000, 31000, 29000, 33000, 35000, 38000],
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgb(239, 68, 68)',
                            borderWidth: 1
                        },
                        {
                            label: 'Net Profit',
                            data: [17000, 21000, 19000, 25000, 27000, 29000],
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            position: 'top',
                            labels: { usePointStyle: true, padding: 20 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value)
                                }
                            }
                        }
                    }
                }
            })

            // Cash Flow Chart
            const cashFlowCtx = document.getElementById('cashFlowChart').getContext('2d')
            charts.cashFlow = new Chart(cashFlowCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                    datasets: [
                        {
                            label: 'Cash Inflow',
                            data: [15000, 22000, 18000, 28000, 25000, 32000],
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Cash Outflow',
                            data: [12000, 15000, 13000, 18000, 16000, 20000],
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            position: 'top',
                            labels: { usePointStyle: true, padding: 20 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value)
                                }
                            }
                        }
                    }
                }
            })

            // Expense Analysis Chart
            const expenseAnalysisCtx = document.getElementById('expenseAnalysisChart').getContext('2d')
            charts.expenseAnalysis = new Chart(expenseAnalysisCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Office Rent', 'Software', 'Marketing', 'Travel', 'Utilities', 'Other'],
                    datasets: [{
                        data: [12000, 8500, 4200, 2800, 1500, 3180],
                        backgroundColor: [
                            'rgb(59, 130, 246)',
                            'rgb(34, 197, 94)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)',
                            'rgb(168, 85, 247)',
                            'rgb(107, 114, 128)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: { padding: 15, usePointStyle: true, font: { size: 11 } }
                        }
                    }
                }
            })
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin)
            document.getElementById('demoLogin').addEventListener('click', handleDemoLogin)
            
            // Navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab))
            })
            
            // Sign out
            document.getElementById('signOut').addEventListener('click', signOut)
            
            // Quick actions
            document.getElementById('quickAddTransaction').addEventListener('click', addTransaction)
            document.getElementById('quickAddClient').addEventListener('click', addClient)
            
            document.getElementById('generateInvoice').addEventListener('click', addInvoice)
            
            // Transaction management
            document.getElementById('addTransactionBtn').addEventListener('click', addTransaction)
            document.getElementById('transactionSearch').addEventListener('input', filterTransactions)
            document.getElementById('transactionFilter').addEventListener('change', filterTransactions)
            document.getElementById('exportTransactions').addEventListener('click', exportTransactions)
            
            // Client management
            document.getElementById('addClientBtn').addEventListener('click', addClient)
            document.getElementById('clientSearch').addEventListener('input', filterClients)
            document.getElementById('clientFilter').addEventListener('change', filterClients)
            document.getElementById('exportClients').addEventListener('click', exportClients)
            
            // Invoice management
            document.getElementById('addInvoiceBtn').addEventListener('click', addInvoice)
            document.getElementById('invoiceSearch').addEventListener('input', filterInvoices)
            document.getElementById('invoiceFilter').addEventListener('change', filterInvoices)
            document.getElementById('exportInvoices').addEventListener('click', exportInvoices)
            
            // Initialize data when dashboard loads
            if (!document.getElementById('dashboard').classList.contains('hidden')) {
                renderTransactions()
                renderClients()
                renderInvoices()
            }
            
            // Reports functionality
            document.getElementById('exportReports').addEventListener('click', exportReports)
            document.getElementById('generateInsights').addEventListener('click', generateInsights)
            document.getElementById('downloadPL').addEventListener('click', downloadProfitLoss)
            document.getElementById('downloadTax').addEventListener('click', downloadTaxSummary)
            document.getElementById('cashFlowDetails').addEventListener('click', showCashFlowDetails)
        })

        // Reports Functions
        function exportReports() {
            const period = document.getElementById('reportPeriod').value
            
            // Create comprehensive report data
            const reportData = {
                period: period,
                generatedDate: new Date().toISOString(),
                kpis: {
                    netProfit: 95270,
                    cashFlow: 42850,
                    avgInvoiceValue: 6847,
                    collectionRate: 94.2
                },
                profitLoss: {
                    totalRevenue: 152650,
                    totalExpenses: 32380,
                    netProfit: 120270,
                    profitMargin: 78.8
                },
                taxSummary: {
                    quarterlyEstimate: 28865,
                    federalTax: 18945,
                    stateTax: 4735,
                    selfEmploymentTax: 5185,
                    totalDeductions: 14100,
                    taxSavings: 3384
                }
            }
            
            // Convert to CSV format
            const csvContent = [
                ['Global Accounting - Comprehensive Report'],
                ['Generated:', new Date().toLocaleDateString()],
                ['Period:', period.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())],
                [''],
                ['Key Performance Indicators'],
                ['Net Profit', formatCurrency(reportData.kpis.netProfit)],
                ['Cash Flow', formatCurrency(reportData.kpis.cashFlow)],
                ['Average Invoice Value', formatCurrency(reportData.kpis.avgInvoiceValue)],
                ['Collection Rate', reportData.kpis.collectionRate + '%'],
                [''],
                ['Profit & Loss Summary'],
                ['Total Revenue', formatCurrency(reportData.profitLoss.totalRevenue)],
                ['Total Expenses', formatCurrency(reportData.profitLoss.totalExpenses)],
                ['Net Profit', formatCurrency(reportData.profitLoss.netProfit)],
                ['Profit Margin', reportData.profitLoss.profitMargin + '%'],
                [''],
                ['Tax Summary'],
                ['Quarterly Tax Estimate', formatCurrency(reportData.taxSummary.quarterlyEstimate)],
                ['Federal Income Tax', formatCurrency(reportData.taxSummary.federalTax)],
                ['State Income Tax', formatCurrency(reportData.taxSummary.stateTax)],
                ['Self-Employment Tax', formatCurrency(reportData.taxSummary.selfEmploymentTax)],
                ['Total Deductions', formatCurrency(reportData.taxSummary.totalDeductions)],
                ['Tax Savings', formatCurrency(reportData.taxSummary.taxSavings)]
            ].map(row => Array.isArray(row) ? row.join(',') : row).join('\n')
            
            const blob = new Blob([csvContent], { type: 'text/csv' })
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = `comprehensive_report_${period}_${new Date().toISOString().split('T')[0]}.csv`
            a.click()
            window.URL.revokeObjectURL(url)
            
            showNotification('Comprehensive report exported successfully!', 'success')
        }
        
        function generateInsights() {
            const button = document.getElementById('generateInsights')
            const originalText = button.innerHTML
            
            button.innerHTML = '<div class="loading-spinner mx-auto"></div>'
            button.disabled = true
            
            setTimeout(() => {
                // Simulate AI analysis
                const insights = [
                    {
                        type: 'recommendation',
                        title: 'Optimize Payment Terms',
                        description: 'Switching to Net 15 terms could improve cash flow by $12,400 monthly.',
                        impact: 'High',
                        color: 'green'
                    },
                    {
                        type: 'trend',
                        title: 'Seasonal Revenue Pattern',
                        description: 'Q4 shows 35% higher revenue. Plan capacity accordingly.',
                        impact: 'Medium',
                        color: 'blue'
                    },
                    {
                        type: 'forecast',
                        title: 'Growth Trajectory',
                        description: 'Current trends suggest 180% annual growth potential.',
                        impact: 'High',
                        color: 'purple'
                    }
                ]
                
                // Create insights modal
                const modal = document.createElement('div')
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in'
                
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto bounce-in">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center space-x-3">
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-3 rounded-xl">
                                    <i class="fas fa-brain text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">AI Business Insights</h3>
                                    <p class="text-sm text-gray-600">Generated based on your financial data</p>
                                </div>
                            </div>
                            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            ${insights.map(insight => `
                                <div class="bg-${insight.color}-50 border-l-4 border-${insight.color}-400 p-4 rounded-lg">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center space-x-2 mb-2">
                                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-${insight.color}-100 text-${insight.color}-800">
                                                    ${insight.type.charAt(0).toUpperCase() + insight.type.slice(1)}
                                                </span>
                                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${insight.impact === 'High' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}">
                                                    ${insight.impact} Impact
                                                </span>
                                            </div>
                                            <h4 class="font-semibold text-${insight.color}-800 mb-1">${insight.title}</h4>
                                            <p class="text-sm text-${insight.color}-700">${insight.description}</p>
                                        </div>
                                        <button class="text-${insight.color}-600 hover:text-${insight.color}-800 ml-4">
                                            <i class="fas fa-bookmark"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-2 mb-2">
                                <i class="fas fa-lightbulb text-yellow-500"></i>
                                <span class="font-semibold text-gray-900">Next Steps</span>
                            </div>
                            <ul class="text-sm text-gray-700 space-y-1">
                                <li>• Review payment terms with top 3 clients</li>
                                <li>• Set up automated invoice reminders</li>
                                <li>• Plan Q4 capacity expansion strategy</li>
                                <li>• Schedule quarterly business review</li>
                            </ul>
                        </div>
                        
                        <div class="flex space-x-3 pt-6 mt-6 border-t border-gray-200">
                            <button onclick="closeModal()" class="flex-1 border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                                Close
                            </button>
                            <button class="bg-gradient-to-r from-purple-500 to-purple-600 text-white py-2 px-4 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200">
                                <i class="fas fa-download mr-2"></i>Export Insights
                            </button>
                        </div>
                    </div>
                `
                
                document.body.appendChild(modal)
                
                button.innerHTML = originalText
                button.disabled = false
                
                showNotification('AI insights generated successfully!', 'success')
            }, 2000)
        }
        
        function downloadProfitLoss() {
            const plData = `
                PROFIT & LOSS STATEMENT
                Global Accounting
                Period: ${new Date().toLocaleDateString()}
                
                REVENUE
                Service Revenue                 $118,450
                Consulting Revenue              $34,200
                ────────────────────────────────────────
                Total Revenue                   $152,650
                
                EXPENSES
                Office Rent                     $12,000
                Software & Tools                $8,500
                Marketing                       $4,200
                Other Expenses                  $7,680
                ────────────────────────────────────────
                Total Expenses                  $32,380
                
                NET PROFIT                      $120,270
                Profit Margin                   78.8%
                
                Generated on ${new Date().toLocaleString()}
            `
            
            const blob = new Blob([plData], { type: 'text/plain' })
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = `profit_loss_statement_${new Date().toISOString().split('T')[0]}.txt`
            a.click()
            window.URL.revokeObjectURL(url)
            
            showNotification('Profit & Loss statement downloaded!', 'success')
        }
        
        function downloadTaxSummary() {
            const taxData = `
                TAX SUMMARY REPORT
                Global Accounting
                Period: ${new Date().toLocaleDateString()}
                
                QUARTERLY TAX ESTIMATE          $28,865
                
                TAX BREAKDOWN
                Federal Income Tax (24%)        $18,945
                State Income Tax (6%)           $4,735
                Self-Employment Tax (15.3%)     $5,185
                
                DEDUCTIBLE EXPENSES
                Business Software               $8,500
                Office Expenses                 $3,200
                Professional Services           $2,400
                ────────────────────────────────────────
                Total Deductions                $14,100
                
                TAX SAVINGS                     $3,384
                
                Generated on ${new Date().toLocaleString()}
            `
            
            const blob = new Blob([taxData], { type: 'text/plain' })
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = `tax_summary_${new Date().toISOString().split('T')[0]}.txt`
            a.click()
            window.URL.revokeObjectURL(url)
            
            showNotification('Tax summary downloaded!', 'success')
        }
        
        function showCashFlowDetails() {
            const modal = document.createElement('div')
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in'
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto bounce-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Cash Flow Analysis Details</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-900">Cash Inflows</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                    <span class="text-sm font-medium">Client Payments</span>
                                    <span class="font-bold text-green-600">$28,500</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                    <span class="text-sm font-medium">New Project Deposits</span>
                                    <span class="font-bold text-green-600">$12,000</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                    <span class="text-sm font-medium">Recurring Services</span>
                                    <span class="font-bold text-green-600">$8,350</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-900">Cash Outflows</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                    <span class="text-sm font-medium">Operating Expenses</span>
                                    <span class="font-bold text-red-600">$15,200</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                    <span class="text-sm font-medium">Tax Payments</span>
                                    <span class="font-bold text-red-600">$7,200</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                    <span class="text-sm font-medium">Equipment & Software</span>
                                    <span class="font-bold text-red-600">$3,600</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                        <h4 class="font-semibold text-blue-900 mb-3">Cash Flow Insights</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-600">$42,850</div>
                                <div class="text-blue-700">Net Cash Flow</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-600">18 days</div>
                                <div class="text-blue-700">Avg Collection Time</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-600">3.2x</div>
                                <div class="text-blue-700">Cash Flow Ratio</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end pt-6 mt-6 border-t border-gray-200">
                        <button onclick="closeModal()" class="border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `
            
            document.body.appendChild(modal)
        }
        
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96737821e2224807',t:'MTc1Mzg2Mzk2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
